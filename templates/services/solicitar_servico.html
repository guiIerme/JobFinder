{% extends 'base.html' %}
{% load static %}

{% block title %}Solicitar Serviço - Job Finder{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Cabeçalho -->
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-concierge-bell me-2"></i>
                        Solicitar Serviço
                    </h4>
                </div>
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h5 class="text-primary mb-2">{{ servico_nome|default:"Serviço Personalizado" }}</h5>
                            <p class="text-muted mb-2">{{ servico_descricao|default:"Descreva o serviço que você precisa" }}</p>
                            <p class="mb-0">
                                <strong>Categoria:</strong> {{ servico_categoria|default:"Personalizado" }}
                            </p>
                        </div>
                        <div class="col-md-4 text-end">
                            <h4 class="text-success mb-0">
                                R$ {{ servico_preco|default:"0,00" }}
                            </h4>
                            <small class="text-muted">Preço estimado</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Formulário -->
            <div class="card shadow-sm">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-user-edit me-2"></i>
                        Seus Dados
                    </h5>
                </div>
                <div class="card-body">
                    <form method="post" action="{% url 'processar_solicitacao' %}">
                        {% csrf_token %}

                        <!-- Dados do serviço (hidden) -->
                        <input type="hidden" name="servico_id" value="{{ servico_id }}">
                        <input type="hidden" name="servico_nome" value="{{ servico_nome }}">
                        <input type="hidden" name="servico_descricao" value="{{ servico_descricao }}">
                        <input type="hidden" name="servico_preco" value="{{ servico_preco }}">

                        <!-- Dados Pessoais -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-primary mb-3">
                                    <i class="fas fa-user me-2"></i>
                                    Informações Pessoais
                                </h6>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="nome_completo" class="form-label">Nome Completo *</label>
                                <input type="text" class="form-control" id="nome_completo" name="nome_completo" value="{{ user.get_full_name|default:user.username }}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="telefone" class="form-label">Telefone *</label>
                                <input type="tel" class="form-control" id="telefone" name="telefone" placeholder="(11) 99999-9999" required>
                            </div>
                            <div class="col-12 mb-3">
                                <label for="email" class="form-label">Email *</label>
                                <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}" required>
                            </div>
                        </div>

                        <!-- Endereço -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-primary mb-3">
                                    <i class="fas fa-map-marker-alt me-2"></i>
                                    Endereço do Serviço
                                </h6>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="cep" class="form-label">CEP *</label>
                                <input type="text" class="form-control" id="cep" name="cep" placeholder="00000-000" maxlength="9" required>
                            </div>
                            <div class="col-md-8 mb-3">
                                <label for="endereco" class="form-label">Endereço *</label>
                                <input type="text" class="form-control" id="endereco" name="endereco" placeholder="Rua, Avenida..." required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="numero" class="form-label">Número *</label>
                                <input type="text" class="form-control" id="numero" name="numero" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="complemento" class="form-label">Complemento</label>
                                <input type="text" class="form-control" id="complemento" name="complemento" placeholder="Apto, Bloco...">
                            </div>
                            <div class="col-md-5 mb-3">
                                <label for="cidade" class="form-label">Cidade *</label>
                                <input type="text" class="form-control" id="cidade" name="cidade" required>
                            </div>
                        </div>

                        <!-- Detalhes do Serviço -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-primary mb-3">
                                    <i class="fas fa-clipboard-list me-2"></i>
                                    Detalhes do Serviço
                                </h6>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="data_preferida" class="form-label">Data Preferida *</label>
                                <input type="date" class="form-control" id="data_preferida" name="data_preferida" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="horario_preferido" class="form-label">Horário Preferido</label>
                                <select class="form-select" id="horario_preferido" name="horario_preferido">
                                    <option value="">Selecione um horário</option>
                                    <option value="08:00">08:00</option>
                                    <option value="09:00">09:00</option>
                                    <option value="10:00">10:00</option>
                                    <option value="11:00">11:00</option>
                                    <option value="14:00">14:00</option>
                                    <option value="15:00">15:00</option>
                                    <option value="16:00">16:00</option>
                                    <option value="17:00">17:00</option>
                                </select>
                            </div>
                            <div class="col-12 mb-3">
                                <label for="observacoes" class="form-label">Observações</label>
                                <textarea class="form-control" id="observacoes" name="observacoes" rows="4" placeholder="Descreva detalhadamente o que você precisa..."></textarea>
                            </div>
                        </div>

                        <!-- Botões -->
                        <div class="d-flex justify-content-between">
                            <a href="{% url 'search_new' %}" class="btn btn-outline-secondary btn-lg">
                                <i class="fas fa-arrow-left me-2"></i>
                                Voltar
                            </a>
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-paper-plane me-2"></i>
                                Enviar Solicitação
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Formatação de CEP
    document.getElementById('cep').addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length > 5) {
            value = value.substring(0, 5) + '-' + value.substring(5, 8);
        }
        e.target.value = value;
    });

    // Formatação de telefone
    document.getElementById('telefone').addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length >= 11) {
            value = `(${value.substring(0, 2)}) ${value.substring(2, 7)}-${value.substring(7, 11)}`;
        } else if (value.length >= 6) {
            value = `(${value.substring(0, 2)}) ${value.substring(2, 6)}-${value.substring(6)}`;
        } else if (value.length >= 2) {
            value = `(${value.substring(0, 2)}) ${value.substring(2)}`;
        }
        e.target.value = value;
    });

    // Data mínima (hoje)
    const hoje = new Date().toISOString().split('T')[0];
    document.getElementById('data_preferida').min = hoje;
</script>
{% endblock %}