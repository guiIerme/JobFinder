{% extends 'base.html' %}
{% load static %}

{% block title %}Detalhes do Serviço - Job Finder{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Header -->
    <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between mb-5 gap-3">
        <div class="d-flex align-items-center">
            <a href="{% url 'service_history_new' %}" class="modern-btn modern-btn-outline me-3 rounded-circle">
                <i class="fas fa-arrow-left"></i>
            </a>
            <div>
                <div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center p-3 mb-3 stats-icon modern-hover-lift">
                    <i class="fas fa-concierge-bell fa-lg text-primary"></i>
                </div>
                <h2 class="mb-2 fw-bold">Detalhes do Serviço</h2>
                <p class="text-muted mb-0">Informações completas sobre o serviço solicitado</p>
            </div>
        </div>
    </div>
    
    <!-- Service Details -->
    <div class="row">
        <div class="col-md-12">
            <div class="modern-card mb-4 shadow border-0 position-relative overflow-hidden">
                <div class="position-absolute top-0 start-0 w-100 h-100" style="background: linear-gradient(135deg, rgba(67, 97, 238, 0.05) 0%, rgba(114, 9, 183, 0.03) 100%);"></div>
                <div class="card-header bg-primary text-white position-relative z-1">
                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center">
                        <div>
                            <h4 class="mb-0 fw-bold">
                                {% if order.service %}
                                    {{ order.service.name }}
                                {% elif order.professional %}
                                    Serviço com {{ order.professional.get_full_name|default:order.professional.username }}
                                {% else %}
                                    Serviço Personalizado
                                {% endif %}
                            </h4>
                            <p class="mb-0 opacity-75">
                                {% if order.service %}
                                    {{ order.service.description }}
                                {% else %}
                                    Serviço solicitado diretamente ao profissional
                                {% endif %}
                            </p>
                        </div>
                        <div class="mt-3 mt-md-0">
                            <span class="modern-badge bg-white text-primary fs-6 rounded-pill px-3 py-2">
                                {% if order.status == 'completed' %}Concluído
                                {% elif order.status == 'in_progress' %}Em andamento
                                {% elif order.status == 'confirmed' %}Confirmado
                                {% elif order.status == 'pending' %}Pendente
                                {% elif order.status == 'cancelled' %}Cancelado
                                {% endif %}
                            </span>
                        </div>
                    </div>
                </div>
                <div class="card-body position-relative z-1">
                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="d-flex align-items-center mb-4">
                                <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center me-3 stats-icon modern-hover-lift" style="width: 40px; height: 40px;">
                                    <i class="fas fa-info-circle text-primary"></i>
                                </div>
                                <h5 class="mb-0 fw-bold">Informações do Pedido</h5>
                            </div>
                            <div class="row mb-3">
                                <div class="col-4 fw-bold">ID do Pedido:</div>
                                <div class="col-8">#{{ order.id }}</div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-4 fw-bold">Data:</div>
                                <div class="col-8">{{ order.scheduled_date|date:"d/m/Y" }}</div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-4 fw-bold">Horário:</div>
                                <div class="col-8">{{ order.scheduled_date|date:"H:i" }}</div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-4 fw-bold">Valor:</div>
                                <div class="col-8 text-primary fw-bold fs-5">R$ {{ order.total_price|floatformat:2 }}</div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-4 fw-bold">Status:</div>
                                <div class="col-8">
                                    <span class="modern-badge 
                                        {% if order.status == 'completed' %}bg-success
                                        {% elif order.status == 'in_progress' %}bg-info
                                        {% elif order.status == 'confirmed' %}bg-warning
                                        {% elif order.status == 'pending' %}bg-secondary
                                        {% elif order.status == 'cancelled' %}bg-danger
                                        {% endif %} rounded-pill px-3 py-1">
                                        {% if order.status == 'pending' %}Pendente
                                        {% elif order.status == 'confirmed' %}Confirmado
                                        {% elif order.status == 'in_progress' %}Em andamento
                                        {% elif order.status == 'completed' %}Concluído
                                        {% elif order.status == 'cancelled' %}Cancelado
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-center mb-4">
                                <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center me-3 stats-icon modern-hover-lift" style="width: 40px; height: 40px;">
                                    <i class="fas fa-map-marker-alt text-primary"></i>
                                </div>
                                <h5 class="mb-0 fw-bold">Endereço</h5>
                            </div>
                            <div class="bg-light p-4 rounded-3">
                                <p class="mb-0">{{ order.address|linebreaksbr }}</p>
                            </div>
                        </div>
                    </div>
                    
                    {% if order.notes %}
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <h5 class="mb-3"><i class="fas fa-sticky-note me-2 text-primary"></i>Observações</h5>
                            <div class="bg-light p-3 rounded">
                                <p class="mb-0">{{ order.notes|linebreaksbr }}</p>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            {% if order.professional %}
            <div class="card mb-4 shadow-sm border-0">
                <div class="card-header bg-info text-white">
                    <h4 class="mb-0"><i class="fas fa-user-tie me-2"></i>Profissional</h4>
                </div>
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center me-3" 
                             style="width: 60px; height: 60px; color: white; font-weight: bold;">
                            {{ order.professional.first_name|slice:":1"|default:"P" }}{{ order.professional.last_name|slice:":1"|default:"U" }}
                        </div>
                        <div>
                            <h5 class="mb-1">{{ order.professional.get_full_name|default:order.professional.username }}</h5>
                            <div class="d-flex align-items-center mb-2">
                                <i class="fas fa-star text-warning me-1"></i>
                                <span>
                                    {{ order.professional.userprofile.rating|floatformat:1 }} 
                                    ({{ order.professional.userprofile.review_count }} avaliações)
                                </span>
                            </div>
                            {% if order.professional.userprofile.phone %}
                            <div class="d-flex align-items-center">
                                <i class="fas fa-phone me-2"></i>
                                <span>{{ order.professional.userprofile.phone }}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Professional Stats -->
                    <div class="row mt-4">
                        <div class="col-md-4 mb-3">
                            <div class="d-flex align-items-center">
                                <div class="bg-info bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 40px; height: 40px;">
                                    <i class="fas fa-clipboard-list text-info"></i>
                                </div>
                                <div>
                                    <div class="small text-muted">Serviços</div>
                                    <div class="fw-bold">42</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="d-flex align-items-center">
                                <div class="bg-success bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 40px; height: 40px;">
                                    <i class="fas fa-check-circle text-success"></i>
                                </div>
                                <div>
                                    <div class="small text-muted">Concluídos</div>
                                    <div class="fw-bold">38</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="d-flex align-items-center">
                                <div class="bg-warning bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 40px; height: 40px;">
                                    <i class="fas fa-clock text-warning"></i>
                                </div>
                                <div>
                                    <div class="small text-muted">Média</div>
                                    <div class="fw-bold">2.5h</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            {% if order.service %}
            <div class="card mb-4 shadow-sm border-0">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0"><i class="fas fa-concierge-bell me-2"></i>Detalhes do Serviço</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="row mb-3">
                                <div class="col-4 fw-bold">Categoria:</div>
                                <div class="col-8">
                                    {% if order.service.category == 'repair' %}Reparo
                                    {% elif order.service.category == 'assembly' %}Montagem
                                    {% elif order.service.category == 'plumbing' %}Encanamento
                                    {% elif order.service.category == 'electrical' %}Elétrica
                                    {% elif order.service.category == 'cleaning' %}Limpeza
                                    {% elif order.service.category == 'painting' %}Pintura
                                    {% else %}Outros
                                    {% endif %}
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-4 fw-bold">Duração:</div>
                                <div class="col-8">{{ order.service.estimated_duration }}</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="row mb-3">
                                <div class="col-4 fw-bold">Preço Base:</div>
                                <div class="col-8">R$ {{ order.service.base_price|floatformat:2 }}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Service Features -->
                    <div class="mt-4">
                        <h5 class="mb-3"><i class="fas fa-star me-2 text-success"></i>Benefícios do Serviço</h5>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex align-items-center">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                <span>Garantia de 30 dias</span>
                            </li>
                            <li class="list-group-item d-flex align-items-center">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                <span>Profissionais verificados</span>
                            </li>
                            <li class="list-group-item d-flex align-items-center">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                <span>Pagamento seguro</span>
                            </li>
                            <li class="list-group-item d-flex align-items-center">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                <span>Suporte 24 horas</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <div class="d-flex flex-wrap gap-2">
                {% if order.status == 'pending' or order.status == 'confirmed' %}
                <a href="#" class="btn btn-outline-danger">
                    <i class="fas fa-times-circle me-1"></i> Cancelar Serviço
                </a>
                {% endif %}
                
                {% if order.professional %}
                <a href="{% url 'create_chat' order.id %}" class="btn btn-outline-primary">
                    <i class="fas fa-comment me-1"></i> Iniciar Chat
                </a>
                {% endif %}
                
                {% if order.status == 'completed' %}
                <a href="#" class="btn btn-outline-warning">
                    <i class="fas fa-star me-1"></i> Avaliar Serviço
                </a>
                {% endif %}
                
                <a href="#" class="btn btn-outline-info">
                    <i class="fas fa-print me-1"></i> Imprimir Comprovante
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

<style>
.card-header {
    border-radius: 0.5rem 0.5rem 0 0 !important;
}

.list-group-item {
    border: none;
    padding: 0.75rem 0;
}
</style>