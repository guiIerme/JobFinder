{% extends 'base.html' %}
{% load static %}

{% block title %}Painel Administrativo - Job Finder{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/visual-effects.css' %}">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        --warning-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --info-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --card-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        --card-hover-shadow: 0 15px 50px rgba(0, 0, 0, 0.15);
    }

    body {
        background: linear-gradient(135deg, #f5f7fa 0%, #e8eef5 100%);
        min-height: 100vh;
    }

    .page-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 20px;
        padding: 2.5rem 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 8px 32px rgba(102, 126, 234, 0.2);
        position: relative;
        overflow: hidden;
        animation: slideDown 0.5s ease-out;
    }

    .page-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.1);
        pointer-events: none;
        z-index: 1;
    }

    .page-header h1 {
        color: white;
        font-weight: 800;
        margin: 0;
        position: relative;
        z-index: 2;
        overflow: hidden;
    }

    .page-header h1::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        animation: shimmer 3s infinite;
    }

    .page-header p {
        color: rgba(255, 255, 255, 0.9);
        position: relative;
        z-index: 2;
    }

    .stats-card {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2rem;
        box-shadow: var(--card-shadow);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        animation: fadeInUp 0.6s ease-out both;
        border-top: 4px solid transparent;
        border: 1px solid rgba(255, 255, 255, 0.18);
        height: 100%;
        position: relative;
        overflow: hidden;
        transform-style: preserve-3d;
        perspective: 1000px;
    }

    .stats-card::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle at center, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
        opacity: 0;
        transition: opacity 0.4s ease;
        pointer-events: none;
        z-index: 1;
    }

    .stats-card:hover {
        transform: translateY(-10px) rotateX(5deg);
        box-shadow: var(--card-hover-shadow);
    }

    .stats-card:hover::before {
        opacity: 1;
    }

    .stats-card.card-primary {
        border-top-color: #667eea;
    }

    .stats-card.card-primary::before {
        background: radial-gradient(circle at center, rgba(102, 126, 234, 0.3) 0%, transparent 70%);
    }

    .stats-card.card-success {
        border-top-color: #11998e;
    }

    .stats-card.card-success::before {
        background: radial-gradient(circle at center, rgba(17, 153, 142, 0.3) 0%, transparent 70%);
    }

    .stats-card.card-info {
        border-top-color: #4facfe;
    }

    .stats-card.card-info::before {
        background: radial-gradient(circle at center, rgba(79, 172, 254, 0.3) 0%, transparent 70%);
    }

    .stats-card.card-warning {
        border-top-color: #f093fb;
    }

    .stats-card.card-warning::before {
        background: radial-gradient(circle at center, rgba(240, 147, 251, 0.3) 0%, transparent 70%);
    }

    .stats-number {
        font-size: 3rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
        position: relative;
        z-index: 2;
    }

    .stats-card.card-primary .stats-number {
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .stats-card.card-success .stats-number {
        background: var(--success-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .stats-card.card-info .stats-number {
        background: var(--info-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .stats-card.card-warning .stats-number {
        background: var(--warning-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .stats-label {
        font-size: 1rem;
        font-weight: 600;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 1px;
        position: relative;
        z-index: 2;
    }

    .stats-trend {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-top: 0.75rem;
        font-size: 0.875rem;
        font-weight: 600;
        position: relative;
        z-index: 2;
        animation: slideInRight 0.6s ease-out 0.3s both;
    }

    .stats-trend i {
        font-size: 1rem;
        animation: bounce 2s infinite;
    }

    .stats-trend.trend-up {
        color: #11998e;
    }

    .stats-trend.trend-up i {
        color: #11998e;
    }

    .stats-trend.trend-down {
        color: #f5576c;
    }

    .stats-trend.trend-down i {
        color: #f5576c;
    }

    @keyframes bounce {

        0%,
        100% {
            transform: translateY(0);
        }

        50% {
            transform: translateY(-3px);
        }
    }

    @keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateX(-20px);
        }

        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @keyframes gradientShift {
        0% {
            background-position: 0% 50%;
        }

        50% {
            background-position: 100% 50%;
        }

        100% {
            background-position: 0% 50%;
        }
    }

    @keyframes shimmer {
        0% {
            left: -100%;
        }

        100% {
            left: 100%;
        }
    }

    .stats-icon {
        width: 60px;
        height: 60px;
        border-radius: 15px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        color: white;
        margin-bottom: 1rem;
        position: relative;
        z-index: 2;
        transition: transform 0.3s ease;
    }

    .stats-card:hover .stats-icon {
        transform: scale(1.1) rotate(5deg);
    }

    .stats-card.card-primary .stats-icon {
        background: var(--primary-gradient);
    }

    .stats-card.card-success .stats-icon {
        background: var(--success-gradient);
    }

    .stats-card.card-info .stats-icon {
        background: var(--info-gradient);
    }

    .stats-card.card-warning .stats-icon {
        background: var(--warning-gradient);
    }

    .content-card {
        background: white;
        border-radius: 20px;
        padding: 2rem;
        box-shadow: var(--card-shadow);
        animation: fadeInUp 0.6s ease-out both;
        margin-bottom: 2rem;
    }

    .section-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #333;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .section-title i {
        width: 45px;
        height: 45px;
        background: var(--primary-gradient);
        color: white;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .table-modern {
        margin: 0;
        table-layout: auto;
        width: 100%;
    }

    .table-modern thead {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        position: relative;
    }

    .table-modern thead::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
        opacity: 0.3;
    }

    .table-modern th {
        font-weight: 600;
        color: #666;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 0.5px;
        border: none;
        padding: 1rem;
        position: relative;
        white-space: nowrap;
    }

    .table-modern td {
        padding: 1rem;
        vertical-align: middle;
        border-bottom: 1px solid #f0f0f0;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Larguras específicas para cada coluna */
    /* Force table layout - CRITICAL FIX */
    .table-modern {
        display: table !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        width: 100% !important;
    }

    .table-modern thead {
        display: table-header-group !important;
    }

    .table-modern tbody {
        display: table-row-group !important;
    }

    .table-modern thead tr,
    .table-modern tbody tr {
        display: table-row !important;
    }

    .table-modern th,
    .table-modern td {
        display: table-cell !important;
        visibility: visible !important;
        padding: 1rem !important;
        vertical-align: middle !important;
    }

    .table-modern th:nth-child(1),
    .table-modern td:nth-child(1) {
        width: 25% !important;
        min-width: 180px !important;
    }

    .table-modern th:nth-child(2),
    .table-modern td:nth-child(2) {
        width: 20% !important;
        min-width: 150px !important;
        white-space: nowrap !important;
    }

    .table-modern th:nth-child(3),
    .table-modern td:nth-child(3) {
        width: 20% !important;
        min-width: 140px !important;
        white-space: nowrap !important;
    }

    .table-modern th:nth-child(4),
    .table-modern td:nth-child(4) {
        width: 15% !important;
        min-width: 120px !important;
        text-align: center !important;
    }

    .table-modern th:nth-child(5),
    .table-modern td:nth-child(5) {
        width: 20% !important;
        min-width: 100px !important;
        text-align: center !important;
    }

    /* Melhorar alinhamento do conteúdo da primeira coluna */
    .table-modern td:nth-child(1) .d-flex {
        gap: 0.75rem;
    }

    .table-modern td:nth-child(1) span {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .table-modern tbody tr {
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        cursor: pointer;
    }

    .table-modern tbody tr::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 4px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        transform: scaleY(0);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border-radius: 0 4px 4px 0;
    }

    .table-modern tbody tr:hover::before {
        transform: scaleY(1);
    }

    .table-modern tbody tr:hover {
        background: linear-gradient(90deg, rgba(102, 126, 234, 0.05) 0%, rgba(255, 255, 255, 0) 100%);
        transform: translateX(8px) scale(1.01);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .table-modern tbody tr:hover td {
        border-bottom-color: rgba(102, 126, 234, 0.2);
    }

    /* Table row animation on entry */
    .table-modern tbody tr[data-animate="slideInRight"] {
        opacity: 0;
        transform: translateX(-30px);
    }

    .table-modern tbody tr[data-animate="slideInRight"].animate-in {
        animation: slideInRight 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }

    /* Smooth reordering transition */
    .table-modern tbody tr.reordering {
        transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1),
            opacity 0.3s ease;
    }

    .table-modern tbody tr.moving-up {
        animation: moveUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .table-modern tbody tr.moving-down {
        animation: moveDown 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes moveUp {
        0% {
            transform: translateY(0);
            opacity: 1;
        }

        50% {
            transform: translateY(-10px);
            opacity: 0.5;
        }

        100% {
            transform: translateY(0);
            opacity: 1;
        }
    }

    @keyframes moveDown {
        0% {
            transform: translateY(0);
            opacity: 1;
        }

        50% {
            transform: translateY(10px);
            opacity: 0.5;
        }

        100% {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .badge-modern {
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-weight: 600;
        font-size: 0.85rem;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        position: relative;
        overflow: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .badge-modern::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: width 0.4s ease, height 0.4s ease;
    }

    .badge-modern:hover::before {
        width: 200%;
        height: 200%;
    }

    .badge-modern:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    /* Animated badge with pulse effect */
    .badge-animated {
        animation: badgePulse 2s ease-in-out infinite;
    }

    @keyframes badgePulse {

        0%,
        100% {
            box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.4);
        }

        50% {
            box-shadow: 0 0 0 8px rgba(102, 126, 234, 0);
        }
    }

    .badge-modern.bg-success.badge-animated {
        animation: badgePulseSuccess 2s ease-in-out infinite;
    }

    @keyframes badgePulseSuccess {

        0%,
        100% {
            box-shadow: 0 0 0 0 rgba(17, 153, 142, 0.4);
        }

        50% {
            box-shadow: 0 0 0 8px rgba(17, 153, 142, 0);
        }
    }

    .badge-modern.bg-primary.badge-animated {
        animation: badgePulsePrimary 2s ease-in-out infinite;
    }

    @keyframes badgePulsePrimary {

        0%,
        100% {
            box-shadow: 0 0 0 0 rgba(13, 110, 253, 0.4);
        }

        50% {
            box-shadow: 0 0 0 8px rgba(13, 110, 253, 0);
        }
    }

    .badge-modern.bg-info.badge-animated {
        animation: badgePulseInfo 2s ease-in-out infinite;
    }

    @keyframes badgePulseInfo {

        0%,
        100% {
            box-shadow: 0 0 0 0 rgba(79, 172, 254, 0.4);
        }

        50% {
            box-shadow: 0 0 0 8px rgba(79, 172, 254, 0);
        }
    }

    .badge-modern.bg-warning.badge-animated {
        animation: badgePulseWarning 2s ease-in-out infinite;
    }

    @keyframes badgePulseWarning {

        0%,
        100% {
            box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.4);
        }

        50% {
            box-shadow: 0 0 0 8px rgba(255, 193, 7, 0);
        }
    }

    .avatar-circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1.1rem;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-30px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes ripple {
        to {
            transform: scale(4);
            opacity: 0;
        }
    }

    @keyframes float {

        0%,
        100% {
            transform: translateY(0px) rotate(0deg);
            opacity: 0.3;
        }

        50% {
            transform: translateY(-20px) rotate(180deg);
            opacity: 0.6;
        }
    }

    .particle {
        position: absolute;
        border-radius: 50%;
        pointer-events: none;
        z-index: 1;
    }

    .col-md-3:nth-child(1) .stats-card {
        animation-delay: 0.1s;
    }

    .col-md-3:nth-child(2) .stats-card {
        animation-delay: 0.2s;
    }

    .col-md-3:nth-child(3) .stats-card {
        animation-delay: 0.3s;
    }

    .col-md-3:nth-child(4) .stats-card {
        animation-delay: 0.4s;
    }

    .content-card:nth-child(1) {
        animation-delay: 0.5s;
    }

    .content-card:nth-child(2) {
        animation-delay: 0.6s;
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {

        .stats-card,
        .stats-card::before,
        .stats-icon,
        .stats-trend,
        .stats-trend i,
        .page-header {
            animation: none !important;
            transition: none !important;
        }

        .stats-card:hover {
            transform: none !important;
        }
    }

    /* Performance mode */
    body.performance-mode .stats-card {
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
        background: white;
    }

    body.performance-mode .stats-card::before {
        display: none;
    }

    body.performance-mode .stats-card:hover {
        transform: translateY(-5px);
    }

    body.performance-mode .stats-trend i {
        animation: none;
    }

    /* Fallback for browsers without backdrop-filter support */
    @supports not (backdrop-filter: blur(10px)) {
        .stats-card {
            background: white;
        }
    }

    /* ============================================
       Tooltip and Popover Styles
       ============================================ */
    .tooltip-modern {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.18);
        border-radius: 12px;
        padding: 0.75rem 1rem;
        font-size: 0.875rem;
        color: #333;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        max-width: 300px;
        word-wrap: break-word;
        pointer-events: none;
    }

    .tooltip-modern.tooltip-popover {
        padding: 1.25rem;
        max-width: 400px;
        pointer-events: auto;
        cursor: default;
    }

    /* Tooltip arrow indicators */
    .tooltip-modern::before {
        content: '';
        position: absolute;
        width: 0;
        height: 0;
        border-style: solid;
    }

    .tooltip-modern.tooltip-position-top::before {
        bottom: -6px;
        left: 50%;
        transform: translateX(-50%);
        border-width: 6px 6px 0 6px;
        border-color: rgba(255, 255, 255, 0.95) transparent transparent transparent;
    }

    .tooltip-modern.tooltip-position-bottom::before {
        top: -6px;
        left: 50%;
        transform: translateX(-50%);
        border-width: 0 6px 6px 6px;
        border-color: transparent transparent rgba(255, 255, 255, 0.95) transparent;
    }

    .tooltip-modern.tooltip-position-left::before {
        right: -6px;
        top: 50%;
        transform: translateY(-50%);
        border-width: 6px 0 6px 6px;
        border-color: transparent transparent transparent rgba(255, 255, 255, 0.95);
    }

    .tooltip-modern.tooltip-position-right::before {
        left: -6px;
        top: 50%;
        transform: translateY(-50%);
        border-width: 6px 6px 6px 0;
        border-color: transparent rgba(255, 255, 255, 0.95) transparent transparent;
    }

    /* Tooltip animations */
    @keyframes tooltipFadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes tooltipSlideUp {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Dark mode tooltip support */
    @media (prefers-color-scheme: dark) {
        .tooltip-modern {
            background: rgba(45, 45, 45, 0.95);
            color: #f0f0f0;
            border-color: rgba(255, 255, 255, 0.1);
        }

        .tooltip-modern.tooltip-position-top::before {
            border-color: rgba(45, 45, 45, 0.95) transparent transparent transparent;
        }

        .tooltip-modern.tooltip-position-bottom::before {
            border-color: transparent transparent rgba(45, 45, 45, 0.95) transparent;
        }

        .tooltip-modern.tooltip-position-left::before {
            border-color: transparent transparent transparent rgba(45, 45, 45, 0.95);
        }

        .tooltip-modern.tooltip-position-right::before {
            border-color: transparent rgba(45, 45, 45, 0.95) transparent transparent;
        }
    }

    /* Reduced motion support for tooltips */
    @media (prefers-reduced-motion: reduce) {
        .tooltip-modern {
            transition: none !important;
            animation: none !important;
        }
    }

    /* Tooltip trigger elements */
    [data-tooltip] {
        cursor: help;
        position: relative;
    }

    [data-tooltip-trigger="click"] {
        cursor: pointer;
    }

    /* ============================================
       Action Button Styles with States
       ============================================ */
    .btn-action {
        position: relative;
        overflow: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        min-width: 100px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-weight: 600;
        border: none;
        cursor: pointer;
        background: var(--primary-gradient);
        color: white;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .btn-action:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-action:active:not(:disabled) {
        transform: translateY(0);
    }

    /* Button States */
    .btn-action.btn-loading {
        pointer-events: none;
        opacity: 0.8;
        cursor: not-allowed;
    }

    .btn-action.btn-success {
        background: var(--success-gradient);
        box-shadow: 0 4px 12px rgba(17, 153, 142, 0.3);
    }

    .btn-action.btn-error {
        background: var(--warning-gradient);
        box-shadow: 0 4px 12px rgba(245, 87, 108, 0.3);
        animation: shake 500ms ease-in-out;
    }

    .btn-action:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        pointer-events: none;
    }

    /* Button Content Wrapper */
    .btn-action .btn-content {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: opacity 0.2s ease;
    }

    .btn-action.btn-loading .btn-content {
        opacity: 0;
    }

    /* Spinner Animation */
    .btn-spinner {
        position: absolute;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 800ms linear infinite;
        opacity: 0;
        pointer-events: none;
    }

    .btn-action.btn-loading .btn-spinner {
        opacity: 1;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    /* State Icons */
    .btn-state-icon {
        position: absolute;
        font-size: 1.2rem;
        opacity: 0;
        transform: scale(0);
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .btn-action.btn-success .btn-state-icon.icon-success {
        opacity: 1;
        transform: scale(1);
    }

    .btn-action.btn-error .btn-state-icon.icon-error {
        opacity: 1;
        transform: scale(1);
    }

    /* Shake Animation for Error State */
    @keyframes shake {

        0%,
        100% {
            transform: translateX(0);
        }

        10%,
        30%,
        50%,
        70%,
        90% {
            transform: translateX(-5px);
        }

        20%,
        40%,
        60%,
        80% {
            transform: translateX(5px);
        }
    }

    /* Button Variants */
    .btn-action.btn-secondary {
        background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
    }

    .btn-action.btn-secondary:hover:not(:disabled) {
        box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
    }

    .btn-action.btn-danger {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
    }

    .btn-action.btn-danger:hover:not(:disabled) {
        box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
    }

    /* Small Button Variant */
    .btn-action.btn-sm {
        min-width: 80px;
        padding: 0.375rem 0.75rem;
        font-size: 0.875rem;
    }

    .btn-action.btn-sm .btn-spinner {
        width: 16px;
        height: 16px;
        border-width: 2px;
    }

    .btn-action.btn-sm .btn-state-icon {
        font-size: 1rem;
    }

    /* Outline Button Variant */
    .btn-action.btn-outline {
        background: transparent;
        border: 2px solid currentColor;
        color: #667eea;
        box-shadow: none;
    }

    .btn-action.btn-outline:hover:not(:disabled) {
        background: rgba(102, 126, 234, 0.1);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }

    .btn-action.btn-outline .btn-spinner {
        border-color: rgba(102, 126, 234, 0.3);
        border-top-color: #667eea;
    }

    /* Ripple Effect for Buttons */
    .btn-action .ripple-effect {
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.6);
        transform: scale(0);
        animation: ripple 600ms ease-out;
        pointer-events: none;
    }

    /* ============================================
       Mobile Responsiveness and Adaptations
       ============================================ */
    @media (max-width: 768px) {

        /* Adjust animation durations to 70% for mobile */
        :root {
            --timing-fast: 140ms;
            --timing-normal: 210ms;
            --timing-slow: 350ms;
            --timing-slower: 560ms;
            --timing-counter: 1050ms;
            --timing-shimmer: 1400ms;
        }

        Font size adjustments */ .page-header h1 {
            font-size: 1.75rem;
            padding: 0.5rem 0;
        }

        .page-header p {
            font-size: 0.875rem;
        }

        .page-header {
            padding: 2rem 1.5rem;
            margin-bottom: 2rem;
            border-radius: 20px;
        }

        .stats-number {
            font-size: 2rem;
        }

        .stats-label {
            font-size: 0.875rem;
        }

        .stats-icon {
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
        }

        /* Reorganize stats cards in single column with sequential animation */
        .stats-card {
            margin-bottom: 1rem;
            padding: 1.5rem;
        }

        /* Sequential animation delays for mobile */
        .col-md-3:nth-child(1) .stats-card {
            animation-delay: 0.1s;
        }

        .col-md-3:nth-child(2) .stats-card {
            animation-delay: 0.25s;
        }

        .col-md-3:nth-child(3) .stats-card {
            animation-delay: 0.4s;
        }

        .col-md-3:nth-child(4) .stats-card {
            animation-delay: 0.55s;
        }

        .stats-trend {
            font-size: 0.75rem;
            margin-top: 0.5rem;
        }

        .stats-trend i {
            font-size: 0.875rem;
        }

        /* Disable 3D transforms on mobile - use simple translateY */
        .stats-card:hover {
            transform: translateY(-5px) !important;
        }

        .stats-card.card-3d:hover {
            transform: translateY(-5px) !important;
        }

        /* Disable 3D icon rotation on mobile */
        .stats-card:hover .stats-icon {
            transform: scale(1.05) !important;
        }

        /* Reduce animation complexity */
        .stats-trend i {
            animation-duration: 3s;
        }

        /* Content cards padding adjustment */
        .content-card {
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 15px;
        }

        .section-title {
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }

        .section-title i {
            width: 38px;
            height: 38px;
            font-size: 1rem;
        }

        /* Simplify table animations on mobile */
        .table-modern tbody tr:hover {
            transform: translateX(4px) scale(1) !important;
        }

        .table-modern tbody tr::before {
            width: 3px;
        }

        .table-modern th,
        .table-modern td {
            padding: 0.75rem 0.5rem;
            font-size: 0.875rem;
        }

        .table-modern th {
            font-size: 0.75rem;
        }

        /* Ajustar larguras das colunas no mobile */
        .table-modern th:nth-child(1),
        .table-modern td:nth-child(1) {
            min-width: 140px;
        }

        .table-modern th:nth-child(2),
        .table-modern td:nth-child(2) {
            min-width: 120px;
        }

        .table-modern th:nth-child(3),
        .table-modern td:nth-child(3) {
            min-width: 110px;
        }

        .table-modern th:nth-child(4),
        .table-modern td:nth-child(4) {
            min-width: 100px;
        }

        .table-modern th:nth-child(5),
        .table-modern td:nth-child(5) {
            min-width: 80px;
        }

        /* Avatar menor no mobile */
        .avatar-circle {
            width: 32px;
            height: 32px;
            font-size: 0.9rem;
        }

        /* Ajustes para cards de prestadores e clientes no mobile */
        .provider-card,
        .customer-card {
            padding: 1rem !important;
        }

        .provider-card .avatar-circle,
        .customer-card .avatar-circle {
            width: 40px !important;
            height: 40px !important;
            font-size: 1rem !important;
        }

        .provider-card h5,
        .customer-card h5 {
            font-size: 1rem !important;
        }

        .provider-card small,
        .customer-card small {
            font-size: 0.75rem !important;
        }

        .services-list {
            margin-top: 1rem !important;
        }

        .services-list .badge {
            font-size: 0.75rem !important;
            padding: 0.4rem 0.6rem !important;
        }

        /* Disable badge pulse animation on mobile */
        .badge-animated {
            animation: none !important;
        }

        .badge-modern {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
        }

        .badge-modern:hover {
            transform: scale(1.02) !important;
        }

        /* Simplify button animations on mobile */
        .btn-action:hover:not(:disabled) {
            transform: translateY(-1px) !important;
        }

        .btn-action {
            min-width: 80px;
            padding: 0.5rem 0.875rem;
            font-size: 0.875rem;
        }

        .btn-action.btn-sm {
            min-width: 70px;
            padding: 0.375rem 0.625rem;
            font-size: 0.8125rem;
        }

        /* Avatar adjustments */
        .avatar-circle {
            width: 35px;
            height: 35px;
            font-size: 1rem;
        }

        /* Tooltip adjustments */
        .tooltip-modern {
            max-width: 250px;
            font-size: 0.8125rem;
            padding: 0.625rem 0.875rem;
        }

        /* Reduce particle size on mobile (handled in JS) */
        .particle {
            opacity: 0.2 !important;
        }

        /* Simplify glassmorphism on mobile for better performance */
        .stats-card {
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        /* Reduce shadow complexity */
        .stats-card {
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .stats-card:hover {
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .content-card {
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        /* Adjust spacing for mobile */
        .container-fluid {
            padding-left: 1rem;
            padding-right: 1rem;
        }

        .row.g-4 {
            --bs-gutter-x: 1rem;
            --bs-gutter-y: 1rem;
        }
    }

    /* Touch device optimizations - disable 3D effects */
    @media (hover: none) and (pointer: coarse) {

        /* Disable all 3D transforms on touch devices */
        .stats-card,
        .stats-card.card-3d,
        .card-3d,
        .card-3d-rotate,
        .card-3d-shadow,
        .card-tilt {
            transform: none !important;
            transform-style: flat !important;
        }

        .section-title {
            font-size: 1.25rem;
        }
    }

    /* ============================================
       Quick Actions Styles
       ============================================ */
    .btn-outline-primary,
    .btn-outline-success,
    .btn-outline-info,
    .btn-outline-warning {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border-width: 2px;
        font-weight: 600;
    }

    .btn-outline-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .btn-outline-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(17, 153, 142, 0.3);
    }

    .btn-outline-info:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(79, 172, 254, 0.3);
    }

    .btn-outline-warning:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
    }

    /* ============================================
       Chart Container Styles
       ============================================ */
    canvas {
        max-width: 100%;
    }

    .btn-group .btn {
        transition: all 0.2s ease;
    }

    .btn-group .btn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: #667eea;
    }

    /* ============================================
       Filter and Search Enhancements
       ============================================ */
    .input-group-text {
        background: white;
        border-right: none;
    }

    .input-group .form-control {
        border-left: none;
    }

    .input-group .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.15);
    }

    .input-group .form-control:focus + .input-group-text {
        border-color: #667eea;
    }

    /* ============================================
       Spin Animation for Refresh Button
       ============================================ */
    @keyframes spin {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(360deg);
        }
    }

    /* ============================================
       Responsive Adjustments for Charts
       ============================================ */
    @media (max-width: 768px) {
        canvas {
            max-height: 250px !important;
        }

        .btn-group {
            width: 100%;
        }

        .btn-group .btn {
            flex: 1;
            font-size: 0.75rem;
            padding: 0.375rem 0.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Page Header with Particles -->
    <div class="page-header">
        <h1>Painel Administrativo
            <i class="fas fa-info-circle ms-2" data-tooltip="Dashboard com estatísticas em tempo real e animações modernas" data-tooltip-position="bottom" style="font-size: 1.5rem; cursor: help; opacity: 0.8;"></i>
        </h1>
        <p class="text-muted mb-0">Bem-vindo ao painel de controle</p>
    </div>

    <!-- Debug: users={{ users_count }}, services={{ services_count }}, orders={{ orders_count }}, requests={{ total_requests }} -->
    
    <!-- Stats Cards Row -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="stats-card card-primary card-3d" data-tooltip="Total de usuários registrados na plataforma. Crescimento de 12% comparado ao mês anterior." data-tooltip-position="top">
                <div class="stats-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stats-number" data-counter="{{ users_count|default:0 }}">0</div>
                <div class="stats-label">Total Usuários</div>
                <div class="stats-trend trend-up">
                    <i class="fas fa-arrow-up"></i>
                    <span>+12% este mês</span>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card card-success card-3d" data-tooltip="Número de serviços atualmente ativos e disponíveis na plataforma." data-tooltip-position="top">
                <div class="stats-icon">
                    <i class="fas fa-briefcase"></i>
                </div>
                <div class="stats-number" data-counter="{{ services_count|default:0 }}">0</div>
                <div class="stats-label">Serviços Ativos</div>
                <div class="stats-trend trend-up">
                    <i class="fas fa-arrow-up"></i>
                    <span>+8% este mês</span>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card card-info card-3d" data-tooltip="Total de pedidos realizados pelos clientes na plataforma." data-tooltip-position="top">
                <div class="stats-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="stats-number" data-counter="{{ orders_count|default:0 }}">0</div>
                <div class="stats-label">Pedidos</div>
                <div class="stats-trend trend-up">
                    <i class="fas fa-arrow-up"></i>
                    <span>+15% este mês</span>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card card-warning card-3d" data-tooltip="Total de solicitações de serviços realizadas pelos clientes." data-tooltip-position="top">
                <div class="stats-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stats-number" data-counter="{{ total_requests|default:0 }}">0</div>
                <div class="stats-label">Solicitações</div>
                <div class="stats-trend trend-up">
                    <i class="fas fa-arrow-up"></i>
                    <span>+3% este mês</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Analytics Charts Section -->
    <div class="row g-4 mb-4">
        <div class="col-lg-8">
            <div class="content-card">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2 class="section-title mb-0">
                        <i class="fas fa-chart-line"></i>
                        Crescimento de Usuários
                    </h2>
                    <div class="d-flex gap-2">
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-primary active" onclick="atualizarGraficoUsuarios('week')">7 dias</button>
                            <button type="button" class="btn btn-outline-primary" onclick="atualizarGraficoUsuarios('month')">30 dias</button>
                            <button type="button" class="btn btn-outline-primary" onclick="atualizarGraficoUsuarios('year')">12 meses</button>
                        </div>
                        <button class="btn btn-sm btn-outline-success" onclick="exportarDadosGrafico('usuarios')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
                <canvas id="userGrowthChart" style="max-height: 300px;"></canvas>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="content-card">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2 class="section-title mb-0">
                        <i class="fas fa-chart-pie"></i>
                        Serviços por Categoria
                    </h2>
                    <button class="btn btn-sm btn-outline-success" onclick="exportarDadosGrafico('categorias')">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
                <canvas id="servicesCategoryChart" style="max-height: 300px;"></canvas>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-4">
        <div class="col-lg-6">
            <div class="content-card">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2 class="section-title mb-0">
                        <i class="fas fa-dollar-sign"></i>
                        Receita Mensal
                    </h2>
                    <div class="btn-group btn-group-sm" role="group">
                        <button class="btn btn-outline-success" onclick="exportarDadosGrafico('receita')">
                            <i class="fas fa-download"></i> Exportar
                        </button>
                    </div>
                </div>
                <canvas id="revenueChart" style="max-height: 250px;"></canvas>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="content-card">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2 class="section-title mb-0">
                        <i class="fas fa-tasks"></i>
                        Status dos Pedidos
                    </h2>
                    <button class="btn btn-sm btn-outline-success" onclick="exportarDadosGrafico('status')">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
                <canvas id="ordersStatusChart" style="max-height: 250px;"></canvas>
            </div>
        </div>
    </div>

    <!-- Quick Actions Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="content-card">
                <h2 class="section-title">
                    <i class="fas fa-bolt"></i>
                    Ações Rápidas
                </h2>
                <div class="row g-3">
                    <div class="col-md-3 col-6">
                        <button class="btn btn-outline-primary w-100 py-3" onclick="acaoRapida('newService')">
                            <i class="fas fa-plus-circle fa-2x mb-2"></i>
                            <div>Novo Serviço</div>
                        </button>
                    </div>
                    <div class="col-md-3 col-6">
                        <button class="btn btn-outline-success w-100 py-3" onclick="acaoRapida('approveRequests')">
                            <i class="fas fa-check-circle fa-2x mb-2"></i>
                            <div>Aprovar Solicitações</div>
                        </button>
                    </div>
                    <div class="col-md-3 col-6">
                        <button class="btn btn-outline-info w-100 py-3" onclick="acaoRapida('exportData')">
                            <i class="fas fa-file-export fa-2x mb-2"></i>
                            <div>Exportar Relatório</div>
                        </button>
                    </div>
                    <div class="col-md-3 col-6">
                        <button class="btn btn-outline-warning w-100 py-3" onclick="acaoRapida('viewReports')">
                            <i class="fas fa-chart-bar fa-2x mb-2"></i>
                            <div>Ver Relatórios</div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Cards -->
    <div class="row">
        <div class="col-12">
            <div class="content-card">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2 class="section-title mb-0">
                        <i class="fas fa-clock"></i>
                        Atividades Recentes
                        <i class="fas fa-question-circle ms-2" data-tooltip="Últimas ações realizadas pelos usuários na plataforma, atualizadas em tempo real." data-tooltip-position="right" style="font-size: 1.2rem; cursor: help; opacity: 0.6;"></i>
                    </h2>
                    <div class="d-flex gap-2">
                        <div class="input-group input-group-sm" style="width: 250px;">
                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                            <input type="text" class="form-control" id="activitySearch" placeholder="Buscar atividades..." onkeyup="filtrarAtividades()">
                        </div>
                        <select class="form-select form-select-sm" id="statusFilter" onchange="filtrarAtividades()" style="width: 150px;">
                            <option value="">Todos Status</option>
                            <option value="pending">Pendente</option>
                            <option value="accepted">Aceito</option>
                            <option value="completed">Concluído</option>
                            <option value="cancelled">Cancelado</option>
                        </select>
                        <div class="btn-group btn-group-sm" role="group">
                            <button class="btn btn-success" onclick="exportarExcelProfissional()" title="Excel com formatação e gráficos">
                                <i class="fas fa-file-excel"></i> Excel Pro
                            </button>
                            <button class="btn btn-outline-success" onclick="exportarAtividades()" title="CSV simples">
                                <i class="fas fa-file-csv"></i> CSV
                            </button>
                        </div>
                        <button class="btn btn-sm btn-outline-primary" onclick="atualizarAtividades()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <!-- Lista de Atividades em Cards Modernos -->
                <div class="activities-list">
                    {% for request in recent_requests %}
                    <div class="activity-card" data-status="{{ request.status }}">
                        <div class="activity-card-header">
                            <div class="activity-user-info">
                                <div class="avatar-circle" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                    {{ request.user.first_name.0|default:'U' }}{{ request.user.last_name.0|default:'' }}
                                </div>
                                <div class="activity-user-details">
                                    <h4 class="activity-user-name">{{ request.user.get_full_name|default:request.user.username }}</h4>
                                    <p class="activity-user-email">{{ request.user.email }}</p>
                                </div>
                            </div>
                            <div class="activity-status-badge">
                                {% if request.status == 'pending' %}
                                <span class="badge badge-modern bg-warning text-dark">
                                    <i class="fas fa-clock"></i> Pendente
                                </span>
                                {% elif request.status == 'accepted' %}
                                <span class="badge badge-modern bg-primary">
                                    <i class="fas fa-check"></i> Aceito
                                </span>
                                {% elif request.status == 'completed' %}
                                <span class="badge badge-modern bg-success">
                                    <i class="fas fa-check-circle"></i> Concluído
                                </span>
                                {% elif request.status == 'cancelled' %}
                                <span class="badge badge-modern bg-danger">
                                    <i class="fas fa-times-circle"></i> Cancelado
                                </span>
                                {% else %}
                                <span class="badge badge-modern bg-info">
                                    <i class="fas fa-info-circle"></i> {{ request.status }}
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="activity-card-body">
                            <div class="activity-info-grid">
                                <div class="activity-info-item">
                                    <i class="fas fa-briefcase activity-icon"></i>
                                    <div>
                                        <span class="activity-label">Serviço</span>
                                        <span class="activity-value">{% if request.service %}{{ request.service.name }}{% else %}{{ request.service_name|default:"N/A" }}{% endif %}</span>
                                    </div>
                                </div>
                                <div class="activity-info-item">
                                    <i class="fas fa-calendar activity-icon"></i>
                                    <div>
                                        <span class="activity-label">Data</span>
                                        <span class="activity-value">{{ request.created_at|date:"d/m/Y H:i" }}</span>
                                    </div>
                                </div>
                                <div class="activity-info-item">
                                    <i class="fas fa-clock activity-icon"></i>
                                    <div>
                                        <span class="activity-label">Há</span>
                                        <span class="activity-value">{{ request.created_at|timesince }}</span>
                                    </div>
                                </div>
                                <div class="activity-info-item">
                                    <i class="fas fa-user-tie activity-icon"></i>
                                    <div>
                                        <span class="activity-label">Prestador</span>
                                        <span class="activity-value">{% if request.provider %}{{ request.provider.get_full_name }}{% else %}Não atribuído{% endif %}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="activity-card-footer">
                            <button class="btn-activity-action" 
                                    onclick="showRequestDetails(
                                        {{ request.id }}, 
                                        '{{ request.user.get_full_name|default:request.user.username|escapejs }}', 
                                        '{% if request.service %}{{ request.service.name|escapejs }}{% else %}N/A{% endif %}', 
                                        '{{ request.description|default:"Sem descrição"|escapejs }}', 
                                        '{{ request.status }}', 
                                        '{{ request.created_at|date:"d/m/Y H:i" }}', 
                                        '{% if request.provider %}{{ request.provider.get_full_name|default:request.provider.username|escapejs }}{% else %}Não atribuído{% endif %}'
                                    )">
                                <i class="fas fa-eye"></i> Ver Detalhes
                            </button>
                            <button class="btn-activity-action btn-secondary" onclick="alert('Editar solicitação #{{ request.id }}')">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                        </div>
                    </div>
                    {% empty %}
                    <div class="empty-state">
                        <i class="fas fa-inbox fa-4x"></i>
                        <h3>Nenhuma atividade recente</h3>
                        <p>As atividades aparecerão aqui quando houver solicitações</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Prestadores e Serviços Section -->
    <div class="row mt-4">
        <div class="col-lg-6">
            <div class="content-card">
                <h2 class="section-title">
                    <i class="fas fa-user-tie"></i>
                    Prestadores de Serviços ({{ providers|length }})
                    <i class="fas fa-info-circle ms-2" data-tooltip="Lista dos prestadores cadastrados e seus serviços ativos na plataforma." data-tooltip-position="right" style="font-size: 1.2rem; cursor: help; opacity: 0.6; margin-left: auto;"></i>
                </h2>
                <div class="mb-3">
                    <input type="text" id="provider-search" class="form-control" placeholder="🔍 Buscar prestador por nome ou email..." 
                           onkeyup="filtrarPrestadores()" 
                           style="border-radius: 10px; padding: 0.75rem; border: 2px solid #e2e8f0; transition: all 0.3s ease;"
                           onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)';"
                           onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none';">
                </div>
                <div class="providers-list" style="max-height: 600px; overflow-y: auto; padding-right: 0.5rem;">
                    {% for provider in providers %}
                    <div class="provider-card" 
                         style="background: white; padding: 1.5rem; border-radius: 15px; margin-bottom: 1rem; box-shadow: 0 4px 15px rgba(0,0,0,0.08); transition: all 0.3s ease; animation: fadeInUp 0.5s ease-out {{ forloop.counter|add:"-1"|floatformat:0|add:"00" }}ms both; cursor: default;">
                        <div class="d-flex align-items-start justify-content-between">
                            <div class="d-flex align-items-center flex-grow-1">
                                <div class="avatar-circle bg-gradient-primary text-white me-3" style="width: 50px; height: 50px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                    {{ provider.user.first_name.0|default:'P' }}{{ provider.user.last_name.0|default:'' }}
                                </div>
                                <div class="flex-grow-1">
                                    <h5 class="mb-1" style="font-weight: 600; color: #2d3748;">
                                        {{ provider.user.get_full_name|default:provider.user.username }}
                                    </h5>
                                    <small class="text-muted">
                                        <i class="fas fa-envelope me-1"></i>{{ provider.user.email }}
                                    </small>
                                </div>
                            </div>
                            <div class="text-end">
                                <span class="badge bg-primary" style="font-size: 0.85rem; padding: 0.5rem 1rem; border-radius: 10px;">
                                    <i class="fas fa-briefcase me-1"></i>{{ provider.user.custom_services.count }} serviço{{ provider.user.custom_services.count|pluralize }}
                                </span>
                            </div>
                        </div>
                        {% if provider.user.custom_services.all %}
                        <div class="services-list mt-3 pt-3" style="border-top: 1px solid #e2e8f0;">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <small class="text-muted" style="font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 0.75rem;">
                                    <i class="fas fa-list me-1"></i>Serviços Oferecidos:
                                </small>
                                <button class="btn btn-sm btn-outline-primary" 
                                        onclick="event.stopPropagation(); showAllServices({{ provider.user.id }}, '{{ provider.user.get_full_name|default:provider.user.username|escapejs }}', [{% for service in provider.user.custom_services.all %}{'id': {{ service.id }}, 'name': '{{ service.name|escapejs }}', 'category': '{{ service.category }}', 'category_display': '{{ service.get_category_display|escapejs }}', 'price': '{{ service.estimated_price }}', 'description': '{{ service.description|escapejs }}'}{% if not forloop.last %},{% endif %}{% endfor %}]);"
                                        style="padding: 0.25rem 0.75rem; border-radius: 8px; font-size: 0.75rem;">
                                    <i class="fas fa-eye me-1"></i>Ver Todos
                                </button>
                            </div>
                            <div class="d-flex flex-wrap gap-2">
                                {% for service in provider.user.custom_services.all|slice:":3" %}
                                <span class="badge bg-light text-dark" style="padding: 0.5rem 0.75rem; border-radius: 8px; font-weight: 500; border: 1px solid #e2e8f0;">
                                    {{ service.name }}
                                </span>
                                {% endfor %}
                                {% if provider.user.custom_services.count > 3 %}
                                <span class="badge bg-light text-muted" style="padding: 0.5rem 0.75rem; border-radius: 8px;">
                                    +{{ provider.user.custom_services.count|add:"-3" }} mais
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    {% empty %}
                    <div class="text-center text-muted py-5">
                        <i class="fas fa-user-tie fa-3x mb-3" style="opacity: 0.3;"></i>
                        <p>Nenhum prestador cadastrado</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Clientes Section -->
        <div class="col-lg-6">
            <div class="content-card">
                <h2 class="section-title">
                    <i class="fas fa-users"></i>
                    Clientes Ativos ({{ customers|length }})
                    <i class="fas fa-info-circle ms-2" data-tooltip="Lista dos clientes mais ativos na plataforma, ordenados por número de solicitações." data-tooltip-position="right" style="font-size: 1.2rem; cursor: help; opacity: 0.6; margin-left: auto;"></i>
                </h2>
                <div class="mb-3">
                    <input type="text" id="customer-search" class="form-control" placeholder="🔍 Buscar cliente por nome ou email..." 
                           onkeyup="filtrarClientes()" 
                           style="border-radius: 10px; padding: 0.75rem; border: 2px solid #e2e8f0; transition: all 0.3s ease;"
                           onfocus="this.style.borderColor='#11998e'; this.style.boxShadow='0 0 0 3px rgba(17, 153, 142, 0.1)';"
                           onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none';">
                </div>
                <div class="customers-list" style="max-height: 600px; overflow-y: auto; padding-right: 0.5rem;">
                    {% for customer in customers %}
                    <div class="customer-card"
                         style="background: white; padding: 1.5rem; border-radius: 15px; margin-bottom: 1rem; box-shadow: 0 4px 15px rgba(0,0,0,0.08); transition: all 0.3s ease; animation: fadeInUp 0.5s ease-out {{ forloop.counter|add:"-1"|floatformat:0|add:"00" }}ms both;">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center flex-grow-1">
                                <div class="avatar-circle bg-gradient-success text-white me-3" style="width: 50px; height: 50px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                                    {{ customer.user.first_name.0|default:'C' }}{{ customer.user.last_name.0|default:'' }}
                                </div>
                                <div class="flex-grow-1">
                                    <h5 class="mb-1" style="font-weight: 600; color: #2d3748;">
                                        {{ customer.user.get_full_name|default:customer.user.username }}
                                    </h5>
                                    <small class="text-muted">
                                        <i class="fas fa-envelope me-1"></i>{{ customer.user.email }}
                                    </small>
                                </div>
                            </div>
                            <div class="text-end">
                                <div class="mb-2">
                                    <span class="badge bg-success" style="font-size: 0.85rem; padding: 0.5rem 1rem; border-radius: 10px;">
                                        <i class="fas fa-file-alt me-1"></i>{{ customer.request_count }} solicitaç{{ customer.request_count|pluralize:"ão,ões" }}
                                    </span>
                                </div>
                                <div class="mb-2">
                                    <small class="text-muted" style="font-size: 0.75rem;">
                                        <i class="fas fa-calendar me-1"></i>Desde {{ customer.user.date_joined|date:"M/Y" }}
                                    </small>
                                </div>
                                {% if customer.request_count > 0 %}
                                <button class="btn btn-sm btn-outline-success" 
                                        onclick="loadCustomerRequests({{ customer.user.id }}, '{{ customer.user.get_full_name|default:customer.user.username|escapejs }}');"
                                        style="padding: 0.25rem 0.75rem; border-radius: 8px; font-size: 0.75rem; width: 100%;">
                                    <i class="fas fa-eye me-1"></i>Ver Solicitações
                                </button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center text-muted py-5">
                        <i class="fas fa-users fa-3x mb-3" style="opacity: 0.3;"></i>
                        <p>Nenhum cliente cadastrado</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons Demo Section -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="content-card">
                <h2 class="section-title">
                    <i class="fas fa-hand-pointer"></i>
                    Botões de Ação Interativos
                    <i class="fas fa-info-circle ms-2" data-tooltip="Demonstração de botões com estados visuais: loading, success e error. Clique nos botões para ver as animações." data-tooltip-position="right" style="font-size: 1.2rem; cursor: help; opacity: 0.6; margin-left: auto;"></i>
                </h2>
                <div class="d-flex flex-wrap gap-3 align-items-center">
                    <button class="btn-action" onclick="testActionButton(this, 'success')">
                        <i class="fas fa-check"></i>
                        Aprovar
                    </button>
                    <button class="btn-action btn-secondary" onclick="testActionButton(this, 'loading')">
                        <i class="fas fa-sync"></i>
                        Processar
                    </button>
                    <button class="btn-action btn-danger" onclick="testActionButton(this, 'error')">
                        <i class="fas fa-times"></i>
                        Rejeitar
                    </button>
                    <button class="btn-action btn-outline" onclick="testActionButton(this, 'async')">
                        <i class="fas fa-cloud-upload-alt"></i>
                        Enviar Dados
                    </button>
                    <button class="btn-action btn-sm" onclick="testActionButton(this, 'success')">
                        <i class="fas fa-save"></i>
                        Salvar
                    </button>
                    <button class="btn-action btn-sm btn-secondary" onclick="testActionButton(this, 'error')">
                        <i class="fas fa-trash"></i>
                        Excluir
                    </button>
                </div>
                <p class="text-muted mt-3 mb-0">
                    <small><i class="fas fa-lightbulb me-1"></i> Clique nos botões para ver as transições de estado: loading → success/error → normal</small>
                </p>
            </div>
        </div>
    </div>

    <!-- Content Transition Demo Section -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="content-card">
                <h2 class="section-title">
                    <i class="fas fa-exchange-alt"></i>
                    Sistema de Transições de Conteúdo
                    <i class="fas fa-info-circle ms-2" data-tooltip="Demonstração de transições suaves de conteúdo, filtros animados e destaque de dados atualizados." data-tooltip-position="right" style="font-size: 1.2rem; cursor: help; opacity: 0.6; margin-left: auto;"></i>
                </h2>

                <!-- Filter Container -->
                <div class="filter-container" id="demo-filter-container">
                    <!-- Filters will be added here dynamically -->
                </div>

                <!-- Demo Controls -->
                <div class="d-flex flex-wrap gap-3 mb-4">
                    <button class="btn-action btn-sm" onclick="demoAddFilter()">
                        <i class="fas fa-plus"></i>
                        Adicionar Filtro
                    </button>
                    <button class="btn-action btn-sm btn-secondary" onclick="demoClearFilters()">
                        <i class="fas fa-times-circle"></i>
                        Limpar Filtros
                    </button>
                    <button class="btn-action btn-sm" onclick="demoFadeTransition()">
                        <i class="fas fa-sync-alt"></i>
                        Transição de Conteúdo
                    </button>
                    <button class="btn-action btn-sm" onclick="demoHighlightData()">
                        <i class="fas fa-highlighter"></i>
                        Destacar Dados
                    </button>
                </div>

                <!-- Demo Content Area -->
                <div id="demo-content-area" class="p-4 border rounded" style="background: #f8f9fa; min-height: 150px;">
                    <h4>Conteúdo de Demonstração</h4>
                    <p class="mb-0">Este é o conteúdo inicial. Clique em "Transição de Conteúdo" para ver a animação de fade.</p>
                </div>

                <p class="text-muted mt-3 mb-0">
                    <small><i class="fas fa-lightbulb me-1"></i> Experimente adicionar filtros, fazer transições de conteúdo e destacar dados atualizados</small>
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Detalhes do Prestador -->
<div class="modal fade" id="providerDetailsModal" tabindex="-1" aria-labelledby="providerDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content" style="border: none; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 2rem;">
                <h5 class="modal-title text-white" id="providerDetailsModalLabel" style="font-weight: 700; font-size: 1.5rem;">
                    <i class="fas fa-user-tie me-2"></i>Detalhes do Prestador
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body" style="padding: 2rem; background: linear-gradient(to bottom, #f8f9fa 0%, #ffffff 100%);">
                <div class="text-center mb-4">
                    <div class="avatar-circle mx-auto mb-3" id="provider-modal-avatar" style="width: 80px; height: 80px; font-size: 2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        P
                    </div>
                    <h4 id="provider-modal-name" style="font-weight: 700; color: #2d3748;">Nome do Prestador</h4>
                    <p id="provider-modal-email" class="text-muted"><i class="fas fa-envelope me-2"></i>email@example.com</p>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="stat-box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 1.5rem; border-radius: 15px; color: white;">
                            <i class="fas fa-briefcase fa-2x mb-2"></i>
                            <h3 id="provider-modal-services-count" style="font-weight: 700; margin: 0;">0</h3>
                            <small>Serviços Cadastrados</small>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="stat-box" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); padding: 1.5rem; border-radius: 15px; color: white;">
                            <i class="fas fa-calendar fa-2x mb-2"></i>
                            <h3 id="provider-modal-join-date" style="font-weight: 700; margin: 0;">-</h3>
                            <small>Membro desde</small>
                        </div>
                    </div>
                </div>

                <div id="provider-modal-services-list" class="mt-4">
                    <!-- Services will be loaded here -->
                </div>
            </div>
            <div class="modal-footer" style="border: none; padding: 1.5rem 2rem; background: #f8f9fa;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 10px; padding: 0.75rem 2rem; font-weight: 600;">
                    <i class="fas fa-times me-2"></i>Fechar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Detalhes do Cliente -->
<div class="modal fade" id="customerDetailsModal" tabindex="-1" aria-labelledby="customerDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content" style="border: none; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div class="modal-header" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border: none; padding: 2rem;">
                <h5 class="modal-title text-white" id="customerDetailsModalLabel" style="font-weight: 700; font-size: 1.5rem;">
                    <i class="fas fa-user me-2"></i>Detalhes do Cliente
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body" style="padding: 2rem; background: linear-gradient(to bottom, #f8f9fa 0%, #ffffff 100%);">
                <div class="text-center mb-4">
                    <div class="avatar-circle mx-auto mb-3" id="customer-modal-avatar" style="width: 80px; height: 80px; font-size: 2rem; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                        C
                    </div>
                    <h4 id="customer-modal-name" style="font-weight: 700; color: #2d3748;">Nome do Cliente</h4>
                    <p id="customer-modal-email" class="text-muted"><i class="fas fa-envelope me-2"></i>email@example.com</p>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="stat-box" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 1.5rem; border-radius: 15px; color: white;">
                            <i class="fas fa-file-alt fa-2x mb-2"></i>
                            <h3 id="customer-modal-requests-count" style="font-weight: 700; margin: 0;">0</h3>
                            <small>Solicitações Realizadas</small>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="stat-box" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 1.5rem; border-radius: 15px; color: white;">
                            <i class="fas fa-calendar fa-2x mb-2"></i>
                            <h3 id="customer-modal-join-date" style="font-weight: 700; margin: 0;">-</h3>
                            <small>Cliente desde</small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="border: none; padding: 1.5rem 2rem; background: #f8f9fa;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 10px; padding: 0.75rem 2rem; font-weight: 600;">
                    <i class="fas fa-times me-2"></i>Fechar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Detalhes da Solicitação -->
<div class="modal fade" id="requestDetailsModal" tabindex="-1" aria-labelledby="requestDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content" style="border: none; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 2rem;">
                <h5 class="modal-title text-white" id="requestDetailsModalLabel" style="font-weight: 700; font-size: 1.5rem;">
                    <i class="fas fa-file-alt me-2"></i>Detalhes da Solicitação
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body" style="padding: 2rem; background: linear-gradient(to bottom, #f8f9fa 0%, #ffffff 100%);">
                <!-- ID da Solicitação -->
                <div class="detail-card mb-3" style="background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); animation: slideInUp 0.4s ease-out;">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <div class="detail-icon" style="width: 50px; height: 50px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-hashtag text-white" style="font-size: 1.5rem;"></i>
                            </div>
                        </div>
                        <div class="col">
                            <small class="text-muted d-block" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">ID da Solicitação</small>
                            <strong id="modal-request-id" style="font-size: 1.25rem; color: #2d3748;">#0000</strong>
                        </div>
                    </div>
                </div>

                <!-- Cliente -->
                <div class="detail-card mb-3" style="background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); animation: slideInUp 0.5s ease-out;">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <div class="detail-icon" style="width: 50px; height: 50px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-user text-white" style="font-size: 1.5rem;"></i>
                            </div>
                        </div>
                        <div class="col">
                            <small class="text-muted d-block" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">Cliente</small>
                            <strong id="modal-user-name" style="font-size: 1.1rem; color: #2d3748;">Nome do Cliente</strong>
                        </div>
                    </div>
                </div>

                <!-- Serviço -->
                <div class="detail-card mb-3" style="background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); animation: slideInUp 0.6s ease-out;">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <div class="detail-icon" style="width: 50px; height: 50px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-briefcase text-white" style="font-size: 1.5rem;"></i>
                            </div>
                        </div>
                        <div class="col">
                            <small class="text-muted d-block" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">Serviço</small>
                            <strong id="modal-service-name" style="font-size: 1.1rem; color: #2d3748;">Nome do Serviço</strong>
                        </div>
                    </div>
                </div>

                <!-- Prestador -->
                <div class="detail-card mb-3" style="background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); animation: slideInUp 0.7s ease-out;">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <div class="detail-icon" style="width: 50px; height: 50px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-user-tie text-white" style="font-size: 1.5rem;"></i>
                            </div>
                        </div>
                        <div class="col">
                            <small class="text-muted d-block" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">Prestador</small>
                            <strong id="modal-provider-name" style="font-size: 1.1rem; color: #2d3748;">Nome do Prestador</strong>
                        </div>
                    </div>
                </div>

                <!-- Status -->
                <div class="detail-card mb-3" style="background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); animation: slideInUp 0.8s ease-out;">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <div class="detail-icon" style="width: 50px; height: 50px; background: linear-gradient(135deg, #ffa751 0%, #ffe259 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-info-circle text-white" style="font-size: 1.5rem;"></i>
                            </div>
                        </div>
                        <div class="col">
                            <small class="text-muted d-block" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">Status</small>
                            <span id="modal-status" class="badge badge-modern badge-animated bg-warning" style="font-size: 1rem; padding: 0.5rem 1rem;">Pendente</span>
                        </div>
                    </div>
                </div>

                <!-- Data -->
                <div class="detail-card mb-3" style="background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); animation: slideInUp 0.9s ease-out;">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <div class="detail-icon" style="width: 50px; height: 50px; background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-calendar text-white" style="font-size: 1.5rem;"></i>
                            </div>
                        </div>
                        <div class="col">
                            <small class="text-muted d-block" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">Data de Criação</small>
                            <strong id="modal-created-at" style="font-size: 1.1rem; color: #2d3748;">00/00/0000 00:00</strong>
                        </div>
                    </div>
                </div>

                <!-- Descrição -->
                <div class="detail-card" style="background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); animation: slideInUp 1s ease-out;">
                    <div class="mb-2">
                        <div class="d-flex align-items-center mb-3">
                            <div class="detail-icon me-3" style="width: 50px; height: 50px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-align-left text-white" style="font-size: 1.5rem;"></i>
                            </div>
                            <small class="text-muted" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">Descrição</small>
                        </div>
                    </div>
                    <p id="modal-description" style="color: #4a5568; line-height: 1.6; margin: 0; padding-left: 66px;">Descrição da solicitação...</p>
                </div>
            </div>
            <div class="modal-footer" style="border: none; padding: 1.5rem 2rem; background: #f8f9fa;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 10px; padding: 0.75rem 2rem; font-weight: 600;">
                    <i class="fas fa-times me-2"></i>Fechar
                </button>
                <button type="button" class="btn btn-primary" onclick="showEditStatusModal()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 10px; padding: 0.75rem 2rem; font-weight: 600;">
                    <i class="fas fa-edit me-2"></i>Editar Status
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Edição de Status -->
<div class="modal fade" id="editStatusModal" tabindex="-1" aria-labelledby="editStatusModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border: none; border-radius: 20px; overflow: hidden;">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1.5rem;">
                <h5 class="modal-title text-white" id="editStatusModalLabel">
                    <i class="fas fa-edit me-2"></i>Editar Status da Solicitação
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body" style="padding: 2rem;">
                <input type="hidden" id="edit-request-id">
                <div class="mb-3">
                    <label for="edit-status-select" class="form-label fw-bold">Novo Status:</label>
                    <select class="form-select" id="edit-status-select" style="border-radius: 10px; padding: 0.75rem;">
                        <option value="pending">Pendente</option>
                        <option value="accepted">Aceito</option>
                        <option value="completed">Concluído</option>
                        <option value="cancelled">Cancelado</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer" style="border: none; padding: 1.5rem;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 10px;">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="saveStatusChange()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 10px;">
                    <i class="fas fa-save me-2"></i>Salvar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Todos os Serviços do Prestador -->
<div class="modal fade" id="allServicesModal" tabindex="-1" aria-labelledby="allServicesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
        <div class="modal-content" style="border: none; border-radius: 20px; overflow: hidden;">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1.5rem;">
                <h5 class="modal-title text-white" id="allServicesModalLabel">
                    <i class="fas fa-briefcase me-2"></i>Serviços de <span id="provider-name-modal"></span>
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body" style="padding: 2rem; max-height: 60vh; overflow-y: auto;">
                <div id="services-list-container"></div>
            </div>
            <div class="modal-footer" style="border: none; padding: 1.5rem; background: #f8f9fa;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 10px;">
                    <i class="fas fa-times me-2"></i>Fechar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Edição de Serviço -->
<div class="modal fade" id="editServiceModal" tabindex="-1" aria-labelledby="editServiceModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content" style="border: none; border-radius: 20px; overflow: hidden;">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1.5rem;">
                <h5 class="modal-title text-white" id="editServiceModalLabel">
                    <i class="fas fa-edit me-2"></i>Editar Serviço
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body" style="padding: 2rem;">
                <input type="hidden" id="edit-service-id">
                <input type="hidden" id="edit-service-provider-id">
                
                <div class="mb-3">
                    <label for="edit-service-name" class="form-label fw-bold">Nome do Serviço:</label>
                    <input type="text" class="form-control" id="edit-service-name" style="border-radius: 10px; padding: 0.75rem;">
                </div>
                
                <div class="mb-3">
                    <label for="edit-service-category" class="form-label fw-bold">Categoria:</label>
                    <select class="form-select" id="edit-service-category" style="border-radius: 10px; padding: 0.75rem;">
                        <option value="repair">Reparo</option>
                        <option value="assembly">Montagem</option>
                        <option value="plumbing">Encanamento</option>
                        <option value="electrical">Elétrica</option>
                        <option value="cleaning">Limpeza</option>
                        <option value="painting">Pintura</option>
                        <option value="carpentry">Marcenaria</option>
                        <option value="gardening">Jardinagem</option>
                        <option value="pest_control">Controle de Pragas</option>
                        <option value="air_conditioning">Ar Condicionado</option>
                        <option value="locksmith">Chaveiro</option>
                        <option value="moving">Mudanças</option>
                        <option value="other">Outros</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label for="edit-service-price" class="form-label fw-bold">Preço Estimado (R$):</label>
                    <input type="number" step="0.01" class="form-control" id="edit-service-price" style="border-radius: 10px; padding: 0.75rem;">
                </div>
                
                <div class="mb-3">
                    <label for="edit-service-description" class="form-label fw-bold">Descrição:</label>
                    <textarea class="form-control" id="edit-service-description" rows="4" style="border-radius: 10px; padding: 0.75rem;"></textarea>
                </div>
            </div>
            <div class="modal-footer" style="border: none; padding: 1.5rem;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 10px;">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="saveServiceEdit()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 10px;">
                    <i class="fas fa-save me-2"></i>Salvar Alterações
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Solicitações do Cliente -->
<div class="modal fade" id="customerRequestsModal" tabindex="-1" aria-labelledby="customerRequestsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
        <div class="modal-content" style="border: none; border-radius: 20px; overflow: hidden;">
            <div class="modal-header" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border: none; padding: 1.5rem;">
                <h5 class="modal-title text-white" id="customerRequestsModalLabel">
                    <i class="fas fa-file-alt me-2"></i>Solicitações de <span id="customer-name-modal"></span>
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body" style="padding: 2rem; max-height: 60vh; overflow-y: auto;">
                <div id="customer-requests-container"></div>
            </div>
            <div class="modal-footer" style="border: none; padding: 1.5rem; background: #f8f9fa;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 10px;">
                    <i class="fas fa-times me-2"></i>Fechar
                </button>
            </div>
        </div>
    </div>
</div>

<style>
@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.detail-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.detail-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.12) !important;
}

.detail-icon {
    transition: all 0.3s ease;
}

.detail-card:hover .detail-icon {
    transform: scale(1.1) rotate(5deg);
}

.modal.fade .modal-dialog {
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.modal.show .modal-dialog {
    transform: scale(1);
}

.modal-content {
    animation: modalZoomIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes modalZoomIn {
    from {
        opacity: 0;
        transform: scale(0.9);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

/* Melhorias nos botões da tabela */
.table-modern tbody tr td button {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.table-modern tbody tr td button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.table-modern tbody tr td button:active {
    transform: translateY(0);
}

.table-modern tbody tr td button::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.5);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}

.table-modern tbody tr td button:hover::before {
    width: 300px;
    height: 300px;
}

/* Animação de entrada para linhas da tabela */
.table-modern tbody tr {
    animation: fadeInRow 0.5s ease-out both;
}

@keyframes fadeInRow {
    from {
        opacity: 0;
        transform: translateX(-20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

/* Estilos para cards de prestadores e clientes */
.provider-card,
.customer-card {
    cursor: pointer;
}

.provider-card:hover,
.customer-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
}

.provider-card .avatar-circle,
.customer-card .avatar-circle {
    transition: all 0.3s ease;
}

.provider-card:hover .avatar-circle,
.customer-card:hover .avatar-circle {
    transform: scale(1.1) rotate(5deg);
}

.providers-list,
.customers-list {
    max-height: 600px;
    overflow-y: auto;
    padding-right: 0.5rem;
}

/* Scrollbar personalizada */
.providers-list::-webkit-scrollbar,
.customers-list::-webkit-scrollbar {
    width: 8px;
}

.providers-list::-webkit-scrollbar-track,
.customers-list::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

.providers-list::-webkit-scrollbar-thumb,
.customers-list::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 10px;
}

.providers-list::-webkit-scrollbar-thumb:hover,
.customers-list::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
}

/* Badge com animação */
.provider-card .badge,
.customer-card .badge {
    transition: all 0.3s ease;
}

.provider-card:hover .badge,
.customer-card:hover .badge {
    transform: scale(1.05);
}

/* Services list badges */
.services-list .badge {
    transition: all 0.2s ease;
}

.services-list .badge:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

/* ============================================
   Activity Cards Styles
   ============================================ */
.activities-list {
    display: grid;
    gap: 1.5rem;
    margin-top: 1rem;
}

.activity-card {
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border-left: 4px solid transparent;
    animation: fadeInUp 0.5s ease-out both;
}

.activity-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
}

.activity-card[data-status="pending"] {
    border-left-color: #f59e0b;
}

.activity-card[data-status="accepted"] {
    border-left-color: #3b82f6;
}

.activity-card[data-status="completed"] {
    border-left-color: #10b981;
}

.activity-card[data-status="cancelled"] {
    border-left-color: #ef4444;
}

.activity-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.25rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #f0f0f0;
}

.activity-user-info {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.activity-user-info .avatar-circle {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.2rem;
    color: white;
    flex-shrink: 0;
}

.activity-user-details {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.activity-user-name {
    font-size: 1.1rem;
    font-weight: 600;
    color: #2d3748;
    margin: 0;
}

.activity-user-email {
    font-size: 0.875rem;
    color: #718096;
    margin: 0;
}

.activity-status-badge .badge {
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.875rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.activity-card-body {
    margin-bottom: 1.25rem;
}

.activity-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.activity-info-item {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 0.75rem;
    background: #f8f9fa;
    border-radius: 10px;
    transition: all 0.2s ease;
}

.activity-info-item:hover {
    background: #e9ecef;
    transform: translateX(4px);
}

.activity-icon {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 8px;
    font-size: 0.875rem;
    flex-shrink: 0;
}

.activity-info-item > div {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.activity-label {
    font-size: 0.75rem;
    color: #718096;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
}

.activity-value {
    font-size: 0.95rem;
    color: #2d3748;
    font-weight: 500;
}

.activity-card-footer {
    display: flex;
    gap: 0.75rem;
    padding-top: 1rem;
    border-top: 1px solid #f0f0f0;
}

.btn-activity-action {
    flex: 1;
    padding: 0.75rem 1.25rem;
    border-radius: 10px;
    border: 2px solid #667eea;
    background: white;
    color: #667eea;
    font-weight: 600;
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.btn-activity-action:hover {
    background: #667eea;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.btn-activity-action.btn-secondary {
    border-color: #6c757d;
    color: #6c757d;
}

.btn-activity-action.btn-secondary:hover {
    background: #6c757d;
    color: white;
    box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
}

.empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: #a0aec0;
}

.empty-state i {
    color: #cbd5e0;
    margin-bottom: 1.5rem;
}

.empty-state h3 {
    color: #4a5568;
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
}

.empty-state p {
    color: #718096;
    font-size: 1rem;
}

/* Responsive adjustments for activity cards */
@media (max-width: 768px) {
    .activity-card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }

    .activity-status-badge {
        width: 100%;
    }

    .activity-status-badge .badge {
        width: 100%;
        justify-content: center;
    }

    .activity-info-grid {
        grid-template-columns: 1fr;
    }

    .activity-card-footer {
        flex-direction: column;
    }

    .btn-activity-action {
        width: 100%;
    }
}
</style>

{% endblock %}

{% block extra_js %}
<script>
    // Debug: Registrar valores do backend
    console.log('🔍 Valores do Backend:', {
        users_count: {{ users_count|default:0 }},
        services_count: {{ services_count|default:0 }},
        orders_count: {{ orders_count|default:0 }},
        total_requests: {{ total_requests|default:0 }}
    });
    
    // Debug: Verificar atributos data-counter após carregamento do DOM
    document.addEventListener('DOMContentLoaded', () => {
        const contadores = document.querySelectorAll('[data-counter]');
        console.log('🔍 Elementos contadores encontrados:', contadores.length);
        contadores.forEach((el, i) => {
            console.log(`Contador ${i}:`, {
                element: el,
                dataCounter: el.getAttribute('data-counter'),
                textContent: el.textContent
            });
        });
    });
</script>
<script src="{% static 'js/admin-dashboard-animations.js' %}"></script>
<script>
    // ============================================
    // Inicialização dos Gráficos
    // ============================================
    let graficoUsuarios, graficoCategoriasServicos, graficoReceita, graficoStatusPedidos;

    function inicializarGraficos() {
        // Obter dados do backend
        const rotulosUsuarios = {{ user_growth_labels|safe }};
        const dadosUsuarios = {{ user_growth_data|safe }};
        const rotulosCategorias = {{ category_labels|safe }};
        const dadosCategorias = {{ category_data|safe }};
        const rotulosReceita = {{ revenue_labels|safe }};
        const dadosReceita = {{ revenue_data|safe }};
        const rotulosStatus = {{ status_labels|safe }};
        const dadosStatus = {{ status_data|safe }};

        // Gráfico de Crescimento de Usuários
        const ctxUsuarios = document.getElementById('userGrowthChart');
        if (ctxUsuarios) {
            graficoUsuarios = new Chart(ctxUsuarios, {
                type: 'line',
                data: {
                    labels: rotulosUsuarios,
                    datasets: [{
                        label: 'Novos Usuários',
                        data: dadosUsuarios,
                        borderColor: 'rgb(102, 126, 234)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#333',
                            bodyColor: '#666',
                            borderColor: '#ddd',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // Gráfico de Categorias de Serviços
        const ctxServicos = document.getElementById('servicesCategoryChart');
        if (ctxServicos) {
            graficoCategoriasServicos = new Chart(ctxServicos, {
                type: 'doughnut',
                data: {
                    labels: rotulosCategorias.length > 0 ? rotulosCategorias : ['Sem dados'],
                    datasets: [{
                        data: dadosCategorias.length > 0 ? dadosCategorias : [1],
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(17, 153, 142, 0.8)',
                            'rgba(79, 172, 254, 0.8)',
                            'rgba(240, 147, 251, 0.8)',
                            'rgba(245, 87, 108, 0.8)'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        // Gráfico de Receita
        const ctxReceita = document.getElementById('revenueChart');
        if (ctxReceita) {
            graficoReceita = new Chart(ctxReceita, {
                type: 'bar',
                data: {
                    labels: rotulosReceita,
                    datasets: [{
                        label: 'Receita (R$)',
                        data: dadosReceita,
                        backgroundColor: 'rgba(17, 153, 142, 0.8)',
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            }
                        }
                    }
                }
            });
        }

        // Gráfico de Status dos Pedidos
        const ctxPedidos = document.getElementById('ordersStatusChart');
        if (ctxPedidos) {
            graficoStatusPedidos = new Chart(ctxPedidos, {
                type: 'pie',
                data: {
                    labels: rotulosStatus.length > 0 ? rotulosStatus : ['Sem dados'],
                    datasets: [{
                        data: dadosStatus.length > 0 ? dadosStatus : [1],
                        backgroundColor: [
                            'rgba(255, 193, 7, 0.8)',
                            'rgba(79, 172, 254, 0.8)',
                            'rgba(17, 153, 142, 0.8)',
                            'rgba(245, 87, 108, 0.8)'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }
    }

    // Atualizar Gráfico de Usuários baseado no período
    function atualizarGraficoUsuarios(periodo) {
        if (!graficoUsuarios) return;

        let rotulos, dados;
        switch(periodo) {
            case 'week':
                rotulos = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'];
                dados = [12, 19, 15, 25, 22, 30, 28];
                break;
            case 'month':
                rotulos = Array.from({length: 30}, (_, i) => i + 1);
                dados = Array.from({length: 30}, () => Math.floor(Math.random() * 30) + 10);
                break;
            case 'year':
                rotulos = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
                dados = [120, 190, 150, 250, 220, 300, 280, 310, 290, 330, 350, 380];
                break;
        }

        graficoUsuarios.data.labels = rotulos;
        graficoUsuarios.data.datasets[0].data = dados;
        graficoUsuarios.update();

        // Atualizar botão ativo
        document.querySelectorAll('.btn-group button').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
    }

    // Exportar Dados do Gráfico
    function exportarDadosGrafico(tipoGrafico) {
        // Mapear tipo de gráfico para URL
        const tipoMap = {
            'receita': 'receita',
            'usuarios': 'usuarios',
            'categorias': 'categorias',
            'status': 'status'
        };
        
        const tipo = tipoMap[tipoGrafico] || tipoGrafico;
        
        // Criar link temporário e fazer download
        const url = `/admin-dashboard-new/exportar-grafico/${tipo}/`;
        window.location.href = url;
    }

    // Ações Rápidas
    function acaoRapida(acao) {
        switch(acao) {
            case 'newService':
                alert('Criar Novo Serviço\n\nEsta funcionalidade abrirá um modal para criar um novo serviço.');
                break;
            case 'approveRequests':
                alert('Aprovar Solicitações Pendentes\n\nEsta funcionalidade abrirá uma lista de solicitações pendentes.');
                break;
            case 'exportData':
                // Exportar relatório completo
                const opcoes = confirm('Deseja exportar o relatório completo do dashboard?\n\n✅ OK = Excel Profissional (XLSX com formatação e gráficos)\n❌ Cancelar = CSV Simples');
                
                if (opcoes) {
                    // Excel profissional
                    window.location.href = '/admin-dashboard-new/exportar-excel-profissional/';
                } else {
                    // Perguntar se quer CSV
                    if (confirm('Deseja exportar em formato CSV simples?')) {
                        window.location.href = '/admin-dashboard-new/exportar-relatorio-completo/';
                    }
                }
                break;
            case 'viewReports':
                alert('Visualizar Relatórios Detalhados\n\nEsta funcionalidade redirecionará para a página de relatórios.');
                break;
            default:
                alert('Ação não implementada');
        }
    }

    // Filtrar Atividades
    function filtrarAtividades() {
        const termoBusca = document.getElementById('activitySearch').value.toLowerCase();
        const filtroStatus = document.getElementById('statusFilter').value;
        const cards = document.querySelectorAll('.activity-card');

        let visibleCount = 0;

        cards.forEach(card => {
            const texto = card.textContent.toLowerCase();
            const cardStatus = card.getAttribute('data-status');

            const correspondeTexto = texto.includes(termoBusca);
            const correspondeStatus = !filtroStatus || cardStatus === filtroStatus;

            if (correspondeTexto && correspondeStatus) {
                card.style.display = '';
                card.style.animation = 'fadeInUp 0.3s ease-out';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });

        // Mostrar mensagem se não houver resultados
        const emptyState = document.querySelector('.empty-state');
        if (emptyState) {
            emptyState.style.display = visibleCount === 0 ? 'block' : 'none';
        }
    }

    // Exportar Atividades (CSV)
    function exportarAtividades() {
        // Fazer download do CSV
        window.location.href = '/admin-dashboard-new/exportar-atividades/';
    }

    // Exportar Excel Profissional (XLSX com formatação)
    function exportarExcelProfissional() {
        // Mostrar mensagem de carregamento
        const btn = event.target.closest('button');
        const originalHTML = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Gerando...';
        
        // Fazer download do Excel
        window.location.href = '/admin-dashboard-new/exportar-excel-profissional/';
        
        // Restaurar botão após 3 segundos
        setTimeout(() => {
            btn.disabled = false;
            btn.innerHTML = originalHTML;
        }, 3000);
    }

    // Atualizar Atividades
    function atualizarAtividades() {
        const botao = event.target.closest('button');
        const icone = botao.querySelector('i');
        
        icone.style.animation = 'spin 1s linear';
        
        setTimeout(() => {
            icone.style.animation = '';
            alert('Atividades atualizadas!');
        }, 1000);
    }

    // Filtrar Prestadores
    function filtrarPrestadores() {
        const termoBusca = document.getElementById('provider-search').value.toLowerCase();
        const prestadores = document.querySelectorAll('.provider-card');

        prestadores.forEach(prestador => {
            const texto = prestador.textContent.toLowerCase();
            if (texto.includes(termoBusca)) {
                prestador.style.display = '';
                prestador.style.animation = 'fadeInUp 0.3s ease-out';
            } else {
                prestador.style.display = 'none';
            }
        });
    }

    // Filtrar Clientes
    function filtrarClientes() {
        const termoBusca = document.getElementById('customer-search').value.toLowerCase();
        const clientes = document.querySelectorAll('.customer-card');

        clientes.forEach(cliente => {
            const texto = cliente.textContent.toLowerCase();
            if (texto.includes(termoBusca)) {
                cliente.style.display = '';
                cliente.style.animation = 'fadeInUp 0.3s ease-out';
            } else {
                cliente.style.display = 'none';
            }
        });
    }

    // Inicializar gráficos quando o DOM estiver pronto
    document.addEventListener('DOMContentLoaded', () => {
        inicializarGraficos();
    });

    /**
     * Test function to demonstrate ActionButton states
     * @param {HTMLElement} button - The button element
     * @param {string} testType - Type of test ('success', 'error', 'loading', 'async')
     */
    function testActionButton(button, testType) {
        // Get the dashboard instance
        const dashboardInstance = window.dashboardInstance;
        if (!dashboardInstance || !dashboardInstance.actionButtons) {
            console.error('Dashboard not initialized');
            return;
        }

        // Get the ActionButton instance for this button
        const actionButton = dashboardInstance.actionButtons.get(button);
        if (!actionButton) {
            console.error('ActionButton instance not found');
            return;
        }

        switch (testType) {
            case 'success':
                // Simulate loading then success
                actionButton.setLoading('Processando...');
                setTimeout(() => {
                    actionButton.setSuccess('Sucesso!');
                }, 1500);
                break;

            case 'error':
                // Simulate loading then error
                actionButton.setLoading('Processando...');
                setTimeout(() => {
                    actionButton.setError('Erro!');
                }, 1500);
                break;

            case 'loading':
                // Show loading state for 3 seconds then reset
                actionButton.setLoading('Carregando...');
                setTimeout(() => {
                    actionButton.reset();
                }, 3000);
                break;

            case 'async':
                // Simulate async action with automatic state management
                actionButton.executeAction(
                    // Simulated async function
                    () => new Promise((resolve, reject) => {
                        setTimeout(() => {
                            // Randomly succeed or fail
                            if (Math.random() > 0.3) {
                                resolve({
                                    success: true
                                });
                            } else {
                                reject(new Error('Falha na operação'));
                            }
                        }, 2000);
                    }), {
                        loadingText: 'Enviando...',
                        successText: 'Enviado!',
                        errorText: 'Falhou!'
                    }
                ).catch(error => {
                    console.log('Action failed:', error.message);
                });
                break;

            default:
                console.warn('Unknown test type:', testType);
        }
    }

    // Store dashboard instance globally for demo purposes
    document.addEventListener('DOMContentLoaded', () => {
        // Wait a bit for dashboard to initialize
        setTimeout(() => {
            // The initDashboard function should return the instance
            // We'll capture it by modifying the init slightly
            console.log('Dashboard demo ready');
        }, 500);
    });

    /**
     * Show provider details in modal
     */
    function showProviderDetails(name, email, avatar, servicesCount, joinDate, services) {
        document.getElementById('provider-modal-name').textContent = name;
        document.getElementById('provider-modal-email').innerHTML = '<i class="fas fa-envelope me-2"></i>' + email;
        document.getElementById('provider-modal-avatar').textContent = avatar;
        document.getElementById('provider-modal-services-count').textContent = servicesCount;
        document.getElementById('provider-modal-join-date').textContent = joinDate;
        
        // Populate services list
        const servicesList = document.getElementById('provider-modal-services-list');
        if (services && services.length > 0) {
            servicesList.innerHTML = `
                <h6 style="font-weight: 600; color: #2d3748; margin-bottom: 1rem;">
                    <i class="fas fa-list me-2"></i>Serviços Oferecidos
                </h6>
                <div class="d-flex flex-wrap gap-2">
                    ${services.map(service => `
                        <span class="badge bg-primary" style="padding: 0.75rem 1rem; border-radius: 10px; font-size: 0.9rem;">
                            ${service}
                        </span>
                    `).join('')}
                </div>
            `;
        } else {
            servicesList.innerHTML = '<p class="text-muted text-center">Nenhum serviço cadastrado</p>';
        }
        
        const modal = new bootstrap.Modal(document.getElementById('providerDetailsModal'));
        modal.show();
    }

    /**
     * Show customer details in modal
     */
    function showCustomerDetails(name, email, avatar, requestsCount, joinDate) {
        document.getElementById('customer-modal-name').textContent = name;
        document.getElementById('customer-modal-email').innerHTML = '<i class="fas fa-envelope me-2"></i>' + email;
        document.getElementById('customer-modal-avatar').textContent = avatar;
        document.getElementById('customer-modal-requests-count').textContent = requestsCount;
        document.getElementById('customer-modal-join-date').textContent = joinDate;
        
        const modal = new bootstrap.Modal(document.getElementById('customerDetailsModal'));
        modal.show();
    }

    /**
     * Show request details in modal
     */
    function showRequestDetails(id, userName, serviceName, description, status, createdAt, providerName) {
        // Populate modal with data
        document.getElementById('modal-request-id').textContent = '#' + id;
        document.getElementById('modal-user-name').textContent = userName;
        document.getElementById('modal-service-name').textContent = serviceName;
        document.getElementById('modal-provider-name').textContent = providerName;
        document.getElementById('modal-created-at').textContent = createdAt;
        document.getElementById('modal-description').textContent = description || 'Sem descrição';

        // Update status badge
        const statusBadge = document.getElementById('modal-status');
        statusBadge.className = 'badge badge-modern badge-animated';
        
        switch(status) {
            case 'pending':
                statusBadge.classList.add('bg-warning');
                statusBadge.textContent = 'Pendente';
                break;
            case 'accepted':
                statusBadge.classList.add('bg-primary');
                statusBadge.textContent = 'Aceito';
                break;
            case 'completed':
                statusBadge.classList.add('bg-success');
                statusBadge.textContent = 'Concluído';
                break;
            case 'cancelled':
                statusBadge.classList.add('bg-danger');
                statusBadge.textContent = 'Cancelado';
                break;
            default:
                statusBadge.classList.add('bg-info');
                statusBadge.textContent = status;
        }

        // Store request ID for editing
        document.getElementById('edit-request-id').value = id;

        // Show modal with animation
        const modal = new bootstrap.Modal(document.getElementById('requestDetailsModal'));
        modal.show();

        // Add entrance animation to cards
        const cards = document.querySelectorAll('.detail-card');
        cards.forEach((card, index) => {
            card.style.animation = 'none';
            setTimeout(() => {
                card.style.animation = `slideInUp 0.4s ease-out ${index * 0.1}s both`;
            }, 10);
        });
    }

    /**
     * Show edit status modal
     */
    function showEditStatusModal() {
        // Close details modal
        const detailsModal = bootstrap.Modal.getInstance(document.getElementById('requestDetailsModal'));
        detailsModal.hide();

        // Show edit modal
        setTimeout(() => {
            const editModal = new bootstrap.Modal(document.getElementById('editStatusModal'));
            editModal.show();
        }, 300);
    }

    /**
     * Save status change
     */
    function saveStatusChange() {
        const requestId = document.getElementById('edit-request-id').value;
        const newStatus = document.getElementById('edit-status-select').value;

        // Get CSRF token
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        // Make AJAX call to update status
        fetch('{% url "update_request_status" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken
            },
            body: JSON.stringify({
                request_id: requestId,
                status: newStatus
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Show success message
                alert('Status atualizado com sucesso!');

                // Close modal
                const editModal = bootstrap.Modal.getInstance(document.getElementById('editStatusModal'));
                editModal.hide();

                // Reload page to show updated data
                setTimeout(() => {
                    location.reload();
                }, 500);
            } else {
                alert('Erro ao atualizar status: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Erro ao atualizar status. Verifique o console para mais detalhes.');
        });
    }

    /**
     * Filter customers by name or email
     */
    function filterCustomers() {
        const searchInput = document.getElementById('customer-search').value.toLowerCase();
        const customerCards = document.querySelectorAll('.customer-card');
        
        let visibleCount = 0;
        customerCards.forEach(card => {
            const text = card.textContent.toLowerCase();
            if (text.includes(searchInput)) {
                card.style.display = '';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });
    }

    /**
     * Load customer requests via AJAX
     */
    function loadCustomerRequests(customerId, customerName) {
        // Set customer name
        document.getElementById('customer-name-modal').textContent = customerName;
        
        // Show loading
        document.getElementById('customer-requests-container').innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin fa-2x"></i><p class="mt-2">Carregando...</p></div>';
        
        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('customerRequestsModal'));
        modal.show();
        
        // Fetch requests
        fetch(`/admin-dashboard-new/customer-requests/${customerId}/`)
            .then(response => {
                console.log('Response status:', response.status);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Data received:', data);
                if (data.success) {
                    showCustomerRequests(customerId, customerName, data.requests);
                } else {
                    document.getElementById('customer-requests-container').innerHTML = `<p class="text-center text-danger">Erro: ${data.error || 'Erro desconhecido'}</p>`;
                }
            })
            .catch(error => {
                console.error('Error details:', error);
                document.getElementById('customer-requests-container').innerHTML = `<p class="text-center text-danger">Erro ao carregar solicitações: ${error.message}</p>`;
            });
    }

    /**
     * Show customer requests
     */
    function showCustomerRequests(customerId, customerName, requests) {
        // Set customer name
        document.getElementById('customer-name-modal').textContent = customerName;

        // Build requests list HTML
        let requestsHTML = '';
        if (requests.length === 0) {
            requestsHTML = '<p class="text-center text-muted">Nenhuma solicitação encontrada.</p>';
        } else {
            requests.forEach((request, index) => {
                const statusColors = {
                    'pending': 'warning',
                    'accepted': 'primary',
                    'completed': 'success',
                    'cancelled': 'danger'
                };
                const statusLabels = {
                    'pending': 'Pendente',
                    'accepted': 'Aceito',
                    'completed': 'Concluído',
                    'cancelled': 'Cancelado'
                };
                const statusColor = statusColors[request.status] || 'info';
                const statusLabel = statusLabels[request.status] || request.status;

                requestsHTML += `
                    <div class="request-detail-card mb-3" style="background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); animation: slideInUp 0.4s ease-out ${index * 0.1}s both;">
                        <div class="d-flex align-items-start justify-content-between">
                            <div class="flex-grow-1">
                                <div class="d-flex align-items-center mb-2">
                                    <h6 class="mb-0 me-3" style="font-weight: 600; color: #2d3748;">
                                        <i class="fas fa-wrench me-2" style="color: #11998e;"></i>${request.service}
                                    </h6>
                                    <span class="badge bg-${statusColor}" style="padding: 0.5rem 0.75rem; border-radius: 8px;">
                                        ${statusLabel}
                                    </span>
                                </div>
                                <p class="mb-2 text-muted" style="font-size: 0.9rem;">${request.description}</p>
                                <small class="text-muted">
                                    <i class="fas fa-calendar me-1"></i>${request.created_at}
                                </small>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // Set requests list
        document.getElementById('customer-requests-container').innerHTML = requestsHTML;

        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('customerRequestsModal'));
        modal.show();
    }

    /**
     * Filter providers by name or email
     */
    function filterProviders() {
        const searchInput = document.getElementById('provider-search').value.toLowerCase();
        const providerCards = document.querySelectorAll('.provider-card');
        
        let visibleCount = 0;
        providerCards.forEach(card => {
            const text = card.textContent.toLowerCase();
            if (text.includes(searchInput)) {
                card.style.display = '';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });
        
        // Update count in title
        const titleElement = document.querySelector('.section-title');
        if (titleElement) {
            const originalText = titleElement.textContent;
            const newText = originalText.replace(/\(\d+\)/, `(${visibleCount})`);
            titleElement.innerHTML = titleElement.innerHTML.replace(/\(\d+\)/, `(${visibleCount})`);
        }
    }

    /**
     * Show all services from a provider
     */
    function showAllServices(providerId, providerName, services) {
        // Set provider name
        document.getElementById('provider-name-modal').textContent = providerName;

        // Build services list HTML
        let servicesHTML = '';
        services.forEach((service, index) => {
            servicesHTML += `
                <div class="service-detail-card mb-3" style="background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); animation: slideInUp 0.4s ease-out ${index * 0.1}s both;">
                    <div class="d-flex align-items-start justify-content-between">
                        <div class="flex-grow-1">
                            <h6 class="mb-2" style="font-weight: 600; color: #2d3748;">
                                <i class="fas fa-wrench me-2" style="color: #667eea;"></i>${service.name}
                            </h6>
                            <p class="mb-2 text-muted" style="font-size: 0.9rem;">${service.description}</p>
                            <div class="d-flex gap-3 flex-wrap align-items-center">
                                <span class="badge bg-light text-dark" style="padding: 0.5rem 0.75rem; border-radius: 8px;">
                                    <i class="fas fa-tag me-1"></i>${service.category_display}
                                </span>
                                <span class="badge bg-success" style="padding: 0.5rem 0.75rem; border-radius: 8px;">
                                    <i class="fas fa-dollar-sign me-1"></i>R$ ${parseFloat(service.price).toFixed(2)}
                                </span>
                            </div>
                        </div>
                        <div class="ms-3">
                            <button class="btn btn-sm btn-outline-primary" onclick="editService(${service.id}, '${service.name.replace(/'/g, "\\'")}', '${service.category}', '${service.price}', '${service.description.replace(/'/g, "\\'")}', ${providerId})" style="border-radius: 8px;">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                        </div>
                    </div>
                </div>
            `;
        });

        // Set services list
        document.getElementById('services-list-container').innerHTML = servicesHTML;

        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('allServicesModal'));
        modal.show();
    }

    /**
     * Edit service
     */
    function editService(serviceId, serviceName, serviceCategory, servicePrice, serviceDescription, providerId) {
        // Set values in edit form
        document.getElementById('edit-service-id').value = serviceId;
        document.getElementById('edit-service-provider-id').value = providerId;
        document.getElementById('edit-service-name').value = serviceName;
        document.getElementById('edit-service-category').value = serviceCategory;
        document.getElementById('edit-service-price').value = servicePrice;
        document.getElementById('edit-service-description').value = serviceDescription;

        // Close all services modal
        const allServicesModal = bootstrap.Modal.getInstance(document.getElementById('allServicesModal'));
        if (allServicesModal) {
            allServicesModal.hide();
        }

        // Show edit modal
        setTimeout(() => {
            const editModal = new bootstrap.Modal(document.getElementById('editServiceModal'));
            editModal.show();
        }, 300);
    }

    /**
     * Save service edit
     */
    function saveServiceEdit() {
        const serviceId = document.getElementById('edit-service-id').value;
        const serviceName = document.getElementById('edit-service-name').value;
        const serviceCategory = document.getElementById('edit-service-category').value;
        const servicePrice = document.getElementById('edit-service-price').value;
        const serviceDescription = document.getElementById('edit-service-description').value;

        // Validate
        if (!serviceName || !servicePrice) {
            alert('Por favor, preencha todos os campos obrigatórios.');
            return;
        }

        // Get CSRF token
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        // Make AJAX call to update service
        fetch('/admin-dashboard-new/update-service/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken
            },
            body: JSON.stringify({
                service_id: serviceId,
                name: serviceName,
                category: serviceCategory,
                price: servicePrice,
                description: serviceDescription
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Serviço atualizado com sucesso!');

                // Close modal
                const editModal = bootstrap.Modal.getInstance(document.getElementById('editServiceModal'));
                editModal.hide();

                // Reload page
                setTimeout(() => {
                    location.reload();
                }, 500);
            } else {
                alert('Erro ao atualizar serviço: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Erro ao atualizar serviço. Verifique o console para mais detalhes.');
        });
    }

    // ============================================
    // Content Transition Demo Functions
    // ============================================

    let filterCount = 0;
    let contentVersion = 1;

    /**
     * Demo: Add a filter badge with animation
     */
    function demoAddFilter() {
        const dashboard = window.dashboardInstance;
        if (!dashboard || !dashboard.contentTransition) {
            console.error('Dashboard not initialized');
            return;
        }

        filterCount++;
        const filterContainer = document.getElementById('demo-filter-container');
        const filterText = `Filtro ${filterCount}`;

        dashboard.contentTransition.addFilterBadge(
            filterContainer,
            filterText,
            () => {
                console.log(`Filter "${filterText}" removed`);
            }
        );
    }

    /**
     * Demo: Clear all filters with animation
     */
    async function demoClearFilters() {
        const dashboard = window.dashboardInstance;
        if (!dashboard || !dashboard.contentTransition) {
            console.error('Dashboard not initialized');
            return;
        }

        const filterContainer = document.getElementById('demo-filter-container');
        await dashboard.contentTransition.clearAllFilters(filterContainer);
        filterCount = 0;
        console.log('All filters cleared');
    }

    /**
     * Demo: Fade transition for content
     */
    async function demoFadeTransition() {
        const dashboard = window.dashboardInstance;
        if (!dashboard || !dashboard.contentTransition) {
            console.error('Dashboard not initialized');
            return;
        }

        const contentArea = document.getElementById('demo-content-area');
        contentVersion++;

        const newContent = `
            <h4>Conteúdo Atualizado (Versão ${contentVersion})</h4>
            <p class="mb-2">Este conteúdo foi carregado com uma transição suave de fade.</p>
            <p class="mb-0"><strong>Timestamp:</strong> ${new Date().toLocaleTimeString('pt-BR')}</p>
        `;

        await dashboard.contentTransition.fadeTransition(contentArea, newContent);
        console.log('Content transition complete');
    }

    /**
     * Demo: Highlight updated data
     */
    async function demoHighlightData() {
        const dashboard = window.dashboardInstance;
        if (!dashboard || !dashboard.contentTransition) {
            console.error('Dashboard not initialized');
            return;
        }

        // Highlight the demo content area
        const contentArea = document.getElementById('demo-content-area');
        await dashboard.contentTransition.highlightUpdate(contentArea, {
            duration: 2000,
            color: 'rgba(102, 126, 234, 0.2)',
            pulseCount: 2
        });

        // Also highlight a random table row
        const tableRows = document.querySelectorAll('.table-modern tbody tr');
        if (tableRows.length > 0) {
            const randomIndex = Math.floor(Math.random() * tableRows.length);
            await dashboard.contentTransition.highlightUpdate(tableRows[randomIndex], {
                duration: 2000,
                color: 'rgba(17, 153, 142, 0.2)',
                pulseCount: 2
            });
        }

        console.log('Data highlight complete');
    }

    /**
     * Demo: Simulate data update with highlight
     */
    async function demoSimulateDataUpdate() {
        const dashboard = window.dashboardInstance;
        if (!dashboard || !dashboard.contentTransition) {
            console.error('Dashboard not initialized');
            return;
        }

        // Highlight all stats cards to simulate data update
        const statsCards = document.querySelectorAll('.stats-card');
        await dashboard.contentTransition.highlightMultiple(statsCards, {
            duration: 2000,
            color: 'rgba(102, 126, 234, 0.15)',
            pulseCount: 1,
            staggerDelay: 150
        });

        console.log('Simulated data update complete');
    }
</script>
{% endblock %}